<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>overload - perldoc.perl.org</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="Content-Language" content="en-gb">
  <link href="static/css-20100830.css" rel="stylesheet" rev="stylesheet" type="text/css" media="screen">
  <link href="static/exploreperl.css" rel="stylesheet" rev="stylesheet" type="text/css">
</head>

<body onLoad="perldoc.startup();" onPageShow="if (event.persisted) perldoc.startup();">
    <div id="page">
      
      <div id="header">
	<div id="homepage_link">
	  <a href="index.html"></a>
	</div>
	<div id="strapline">
	  Perl Programming Documentation
	</div>
	<div id="download_link" class="download">
	  <a href="http://www.perl.org/get.html">Download Perl</a>
	</div>
	<div id="explore_link" class="download">
	  <a id="explore_anchor" href="#">Explore</a>
	</div>
      </div>
      
      <div id="body">
        <div id="left_column">
          <div class="side_group">
            
	    <div class="side_panel doc_panel">
              <p>Manual</p>
              <ul>
                <li><a href="index-overview.html">Overview</a>
                <li><a href="index-tutorials.html">Tutorials</a>
                <li><a href="index-faq.html">FAQs</a>
                <li><a href="index-history.html">History / Changes</a>
                <li><a href="index-licence.html">License</a>
              </ul>
            </div>
            <div class="side_panel doc_panel">
              <p>Reference</p>
              <ul>
                <li><a href="index-language.html">Language</a>
                <li><a href="index-functions.html">Functions</a>
                <li><a href="perlop.html">Operators</a>
                <li><a href="perlvar.html">Special Variables</a>
                <li><a href="index-pragmas.html">Pragmas</a>
                <li><a href="index-utilities.html">Utilities</a>
                <li><a href="index-internals.html">Internals</a>
                <li><a href="index-platforms.html">Platform Specific</a>
              </ul>
            </div>
            <div class="side_panel doc_panel">
              <p>Modules</p>
              <ul>
		<li>
		
                
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		
                  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		
                  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		    
		  
		
                  
		
                  
		
                  
		    
		  
		
                  
		
                  
		
		
                    <a href="index-modules-A.html">A</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-B.html">B</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-C.html">C</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-D.html">D</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-E.html">E</a>
                    
                      
                        <li>
                      
                    
                
                    <a href="index-modules-F.html">F</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-G.html">G</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-H.html">H</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-I.html">I</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-L.html">L</a>
                    
                      
                        <li>
                      
                    
                
                    <a href="index-modules-M.html">M</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-N.html">N</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-O.html">O</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-P.html">P</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-S.html">S</a>
                    
                      
                        <li>
                      
                    
                
                    <a href="index-modules-T.html">T</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-U.html">U</a>
                    
                      
                        &bull;
                      
                    
                
                    <a href="index-modules-X.html">X</a>
                    
                
              </ul>
            </div>
            
	      <div class="side_panel doc_panel">
		<p>Tools</p>
		<ul>
		  <li><a href="preferences.html">Preferences</a>
		</ul>
	      </div>
            
          </div>
        </div>
        <div id="centre_column">
          <div id="content_header">
            <div id="title_bar">
              <div id="page_name">
                <h1>overload</h1>
              </div>
              <div id="perl_version">
                Perl 5 version 12.2 documentation
              </div>
              <div class="page_links" id="page_links_top">
                <a href="#" onClick="toolbar.goToTop();return false;">Go to top</a>
		
                  &bull; <a href="overload.pdf">Download PDF</a>
		
              </div>
	      <div class="page_links" id="page_links_bottom">
		
                  <a href="#" id="page_index_toggle">Show page index</a> &bull;
		
                <a href="#" id="recent_pages_toggle">Show recent pages</a>		
	      </div>
	      <div id="search_form">
		<form action="search.html" method="GET" id="search">
		  <input type="text" name="q" id="search_box" alt="Search">
		</form>
	      </div>
            </div>
            <div id="breadcrumbs">
                
    <a href="index.html">Home</a> &gt;
    
      
        <a href="index-pragmas.html">Pragmas</a> &gt;
      
    
    overload
  

            </div>
          </div>
          <div id="content_body">
	    <!--[if lt IE 7]>
 <div class="noscript">
   <p>
     <strong>It looks like you're using Internet Explorer 6. This is a very old
     browser which does not offer full support for modern websites.</strong>
   </p>
   <p>
     Unfortunately this means that this website will not work on
     your computer.
   </p>
   <p>
     Don't miss out though! To view the site (and get a better experience from
     many other websites), simply upgrade to
     <a href="http://www.microsoft.com/windows/Internet-explorer/default.aspx">Internet
Explorer 8</a>
     or download an alternative browser such as
     <a href="http://www.mozilla.com/en-US/firefox/firefox.html">Firefox</a>,
     <a href="http://www.apple.com/safari/download/">Safari</a>, or
     <a href="http://www.google.co.uk/chrome">Google Chrome</a>.
   </p>
   <p>
     All of these browsers are free. If you're using a PC at work, you may
     need to contact your IT administrator.
   </p>
 </div>
<![endif]-->
	    <noscript>
	      <div class="noscript">
	      <p>
                <strong>Please note: Many features of this site require JavaScript. You appear to have JavaScript disabled,
	        or are running a non-JavaScript capable web browser.</strong>
	      </p>
	      <p>
		To get the best experience, please enable JavaScript or download a modern web browser such as <a href="http://www.microsoft.com/windows/Internet-explorer/default.aspx">Internet Explorer 8</a>, <a href="http://www.mozilla.com/en-US/firefox/firefox.html">Firefox</a>, <a href="http://www.apple.com/safari/download/">Safari</a>, or <a href="http://www.google.co.uk/chrome">Google Chrome</a>.
              </p>
	      </div>
	    </noscript>

	    <div id="recent_pages" class="hud_container">
	      <div id="recent_pages_header" class="hud_header">
		<div id="recent_pages_close" class="hud_close"><a href="#" onClick="recentPages.hide();return false;"></a></div>
		<div id="recent_pages_title" class="hud_title"><span class="hud_span_top">Recently read</span></div>
		<div id="recent_pages_topright" class="hud_topright"></div>
	      </div>
	      <div id="recent_pages_content" class="hud_content">
	      </div>
	      <div id="recent_pages_footer" class="hud_footer">
		<div id="recent_pages_bottomleft" class="hud_bottomleft"></div>
		<div id="recent_pages_bottom" class="hud_bottom"><span class="hud_span_bottom"></span></div>
		<div id="recent_pages_resize" class="hud_resize"></div>
	      </div>
	    </div>
  
	    <div id="from_search"></div>
            <h1>overload</h1>


  <!--    -->
<ul><li><a href="#NAME">NAME</a><li><a href="#SYNOPSIS">SYNOPSIS</a><li><a href="#DESCRIPTION">DESCRIPTION</a><ul><li><a href="#Declaration-of-overloaded-functions">Declaration of overloaded functions</a><li><a href="#Calling-Conventions-for-Binary-Operations">Calling Conventions for Binary Operations</a><li><a href="#Calling-Conventions-for-Unary-Operations">Calling Conventions for Unary Operations</a><li><a href="#Calling-Conventions-for-Mutators">Calling Conventions for Mutators</a><li><a href="#Overloadable-Operations">Overloadable Operations</a><li><a href="#Inheritance-and-overloading">Inheritance and overloading</a></ul><li><a href="#SPECIAL-SYMBOLS-FOR-use-overload">SPECIAL SYMBOLS FOR use overload</a><ul><li><a href="#Last-Resort">Last Resort</a><li><a href="#Fallback">Fallback</a><li><a href="#Copy-Constructor">Copy Constructor</a></ul><li><a href="#MAGIC-AUTOGENERATION">MAGIC AUTOGENERATION</a><li><a href="#Minimal-set-of-overloaded-operations">Minimal set of overloaded operations</a><li><a href="#Losing-overloading">Losing overloading</a><li><a href="#Run-time-Overloading">Run-time Overloading</a><li><a href="#Public-functions">Public functions</a><li><a href="#Overloading-constants">Overloading constants</a><li><a href="#IMPLEMENTATION">IMPLEMENTATION</a><li><a href="#Metaphor-clash">Metaphor clash</a><li><a href="#Cookbook">Cookbook</a><ul><li><a href="#Two-face-scalars">Two-face scalars</a><li><a href="#Two-face-references">Two-face references</a><li><a href="#Symbolic-calculator">Symbolic calculator</a><li><a href="#_Really_-symbolic-calculator">_Really_ symbolic calculator</a></ul><li><a href="#AUTHOR">AUTHOR</a><li><a href="#SEE-ALSO">SEE ALSO</a><li><a href="#DIAGNOSTICS">DIAGNOSTICS</a><li><a href="#BUGS">BUGS</a></ul><a name="NAME"></a><h1>NAME</h1>
<p>overload - Package for overloading Perl operations</p>
<a name="SYNOPSIS"></a><h1>SYNOPSIS</h1>
<pre class="verbatim"><ol><li><a name="package-SomeThing"></a>    package <span class="i">SomeThing</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></li><li>	<span class="q">&#39;+&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;myadd</span><span class="cm">,</span></li><li>	<span class="q">&#39;-&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;mysub</span><span class="sc">;</span></li><li>	<span class="c"># etc</span></li><li>    ...</li><li></li><li><a name="package-main"></a>    package <span class="i">main</span><span class="sc">;</span></li><li>    <span class="i">$a</span> = <span class="w">SomeThing</span><span class="w">-&gt;new</span><span class="s">(</span> <span class="n">57</span> <span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$b</span>=<span class="n">5</span>+<span class="i">$a</span><span class="sc">;</span></li><li>    ...</li><li>    if <span class="s">(</span><span class="w">overload::Overloaded</span> <span class="i">$b</span><span class="s">)</span> <span class="s">{</span>...<span class="s">}</span></li><li>    ...</li><li>    <span class="i">$strval</span> = <span class="w">overload::StrVal</span> <span class="i">$b</span><span class="sc">;</span></li></ol></pre><a name="DESCRIPTION"></a><h1>DESCRIPTION</h1>
<p>This pragma allows overloading of Perl's operators for a class.
To overload built-in functions, see <a href="perlsub.html#Overriding-Built-in-Functions">Overriding Built-in Functions in perlsub</a> instead.</p>
<a name="Declaration-of-overloaded-functions"></a><h2>Declaration of overloaded functions</h2>
<p>The compilation directive</p>
<pre class="verbatim"><ol><li><a name="package-Number"></a>    package <span class="i">Number</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></li><li>	<span class="q">&quot;+&quot;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;add</span><span class="cm">,</span></li><li>	<span class="q">&quot;*=&quot;</span> <span class="cm">=&gt;</span> <span class="q">&quot;muas&quot;</span><span class="sc">;</span></li></ol></pre><p>declares function Number::add() for addition, and method muas() in
the "class" <code class="inline"><span class="w">Number</span></code>
 (or one of its base classes)
for the assignment form <code class="inline"><span class="i">*=</span></code>
 of multiplication.</p>
<p>Arguments of this directive come in (key, value) pairs.  Legal values
are values legal inside a <code class="inline"><span class="i">&amp;</span>{ ... }</code>
 call, so the name of a
subroutine, a reference to a subroutine, or an anonymous subroutine
will all work.  Note that values specified as strings are
interpreted as methods, not subroutines.  Legal keys are listed below.</p>
<p>The subroutine <code class="inline"><span class="w">add</span></code>
 will be called to execute <code class="inline"><span class="i">$a</span>+<span class="i">$b</span></code>
 if $a
is a reference to an object blessed into the package <code class="inline"><span class="w">Number</span></code>
, or if $a is
not an object from a package with defined mathemagic addition, but $b is a
reference to a <code class="inline"><span class="w">Number</span></code>
.  It can also be called in other situations, like
<code class="inline"><span class="i">$a</span>+=<span class="n">7</span></code>
, or <code class="inline"><span class="i">$a</span>++</code>
.  See <a href="#MAGIC-AUTOGENERATION">MAGIC AUTOGENERATION</a>.  (Mathemagical
methods refer to methods triggered by an overloaded mathematical
operator.)</p>
<p>Since overloading respects inheritance via the @ISA hierarchy, the
above declaration would also trigger overloading of <code class="inline">+</code>
 and <code class="inline"><span class="i">*=</span></code>
 in
all the packages which inherit from <code class="inline"><span class="w">Number</span></code>
.</p>
<a name="Calling-Conventions-for-Binary-Operations"></a><h2>Calling Conventions for Binary Operations</h2>
<p>The functions specified in the <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> ...</code>
 directive are called
with three (in one particular case with four, see <a href="#Last-Resort">Last Resort</a>)
arguments.  If the corresponding operation is binary, then the first
two arguments are the two arguments of the operation.  However, due to
general object calling conventions, the first argument should always be
an object in the package, so in the situation of <code class="inline"><span class="n">7</span>+<span class="i">$a</span></code>
, the
order of the arguments is interchanged.  It probably does not matter
when implementing the addition method, but whether the arguments
are reversed is vital to the subtraction method.  The method can
query this information by examining the third argument, which can take
three different values:</p>
<ul>
<li><a name="FALSE"></a><b>FALSE</b>
<p>the order of arguments is as in the current operation.</p>
</li>
<li><a name="TRUE"></a><b>TRUE</b>
<p>the arguments are reversed.</p>
</li>
<li><a name="undef"></a><b><code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code></b>
<p>the current operation is an assignment variant (as in
<code class="inline"><span class="i">$a</span>+=<span class="n">7</span></code>
), but the usual function is called instead.  This additional
information can be used to generate some optimizations.  Compare
<a href="#Calling-Conventions-for-Mutators">Calling Conventions for Mutators</a>.</p>
</li>
</ul>
<a name="Calling-Conventions-for-Unary-Operations"></a><h2>Calling Conventions for Unary Operations</h2>
<p>Unary operation are considered binary operations with the second
argument being <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code>.  Thus the functions that overloads <code class="inline"><span class="s">{</span><span class="q">&quot;++&quot;</span><span class="s">}</span></code>

is called with arguments <code class="inline"><span class="s">(</span><span class="i">$a</span><span class="cm">,</span><a class="l_k" href="functions/undef.html">undef</a><span class="cm">,</span><span class="q">&#39;&#39;</span><span class="s">)</span></code>
 when $a++ is executed.</p>
<a name="Calling-Conventions-for-Mutators"></a><h2>Calling Conventions for Mutators</h2>
<p>Two types of mutators have different calling conventions:</p>
<ul>
<li><a name="%2b%2b-and---"></a><b><code class="inline">++</code>
 and <code class="inline">--</code>
</b>
<p>The routines which implement these operators are expected to actually
<i>mutate</i> their arguments.  So, assuming that $obj is a reference to a
number,</p>
<pre class="verbatim"><ol><li><a name="incr"></a>  sub <span class="m">incr</span> <span class="s">{</span> <a class="l_k" href="functions/my.html">my</a> <span class="i">$n</span> = <span class="i">$</span> {<span class="i">$_</span>[<span class="n">0</span>]}<span class="sc">;</span> ++<span class="i">$n</span><span class="sc">;</span> <span class="i">$_</span>[<span class="n">0</span>] = <a class="l_k" href="functions/bless.html">bless</a> \<span class="i">$n</span><span class="s">}</span></li></ol></pre><p>is an appropriate implementation of overloaded <code class="inline">++</code>
.  Note that</p>
<pre class="verbatim"><ol><li><a name="incr"></a>  sub <span class="m">incr</span> <span class="s">{</span> ++<span class="i">$</span> {<span class="i">$_</span>[<span class="n">0</span>]} <span class="sc">;</span> <a class="l_k" href="functions/shift.html">shift</a> <span class="s">}</span></li></ol></pre><p>is OK if used with preincrement and with postincrement. (In the case
of postincrement a copying will be performed, see <a href="#Copy-Constructor">Copy Constructor</a>.)</p>
</li>
<li><a name="x%3d-and-other-assignment-versions"></a><b><code class="inline"><span class="w">x</span>=</code>
 and other assignment versions</b>
<p>There is nothing special about these methods.  They may change the
value of their arguments, and may leave it as is.  The result is going
to be assigned to the value in the left-hand-side if different from
this value.</p>
<p>This allows for the same method to be used as overloaded <code class="inline">+=</code>
 and
<code class="inline">+</code>
.  Note that this is <i>allowed</i>, but not recommended, since by the
semantic of <a href="#Fallback">Fallback</a> Perl will call the method for <code class="inline">+</code>
 anyway,
if <code class="inline">+=</code>
 is not overloaded.</p>
</li>
</ul>
<p><b>Warning.</b>  Due to the presence of assignment versions of operations,
routines which may be called in assignment context may create
self-referential structures.  Currently Perl will not free self-referential
structures until cycles are <code class="inline"><span class="w">explicitly</span></code>
 broken.  You may get problems
when traversing your structures too.</p>
<p>Say,</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="q">&#39;+&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span> \<span class="i">$_</span>[<span class="n">0</span>]<span class="cm">,</span> \<span class="i">$_</span>[<span class="n">1</span>] <span class="s">]</span> <span class="s">}</span><span class="sc">;</span></li></ol></pre><p>is asking for trouble, since for code <code class="inline"><span class="i">$obj</span> += <span class="i">$foo</span></code>
 the subroutine
is called as <code class="inline"><span class="i">$obj</span> = <span class="i">add</span><span class="s">(</span><span class="i">$obj</span><span class="cm">,</span> <span class="i">$foo</span><span class="cm">,</span> <a class="l_k" href="functions/undef.html">undef</a><span class="s">)</span></code>
, or <code class="inline"><span class="i">$obj</span> = <span class="s">[</span>\<span class="i">$obj</span><span class="cm">,</span>
\<span class="i">$foo</span><span class="s">]</span></code>
.  If using such a subroutine is an important optimization, one
can overload <code class="inline">+=</code>
 explicitly by a non-"optimized" version, or switch
to non-optimized version if <code class="inline">not <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$_</span>[<span class="n">2</span>]</code>
 (see
<a href="#Calling-Conventions-for-Binary-Operations">Calling Conventions for Binary Operations</a>).</p>
<p>Even if no <i>explicit</i> assignment-variants of operators are present in
the script, they may be generated by the optimizer.  Say, <code class="inline"><span class="q">&quot;,$obj,&quot;</span></code>
 or
<code class="inline"><span class="q">&#39;,&#39;</span> . <span class="i">$obj</span> . <span class="q">&#39;,&#39;</span></code>
 may be both optimized to</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$tmp</span> = <span class="q">&#39;,&#39;</span> . <span class="i">$obj</span><span class="sc">;</span>    <span class="i">$tmp</span> .= <span class="q">&#39;,&#39;</span><span class="sc">;</span></li></ol></pre><a name="Overloadable-Operations"></a><h2>Overloadable Operations</h2>
<p>The following symbols can be specified in <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
 directive:</p>
<ul>
<li><a name="*-_Arithmetic-operations_"></a><b><i>Arithmetic operations</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;+&quot;</span><span class="cm">,</span> <span class="q">&quot;+=&quot;</span><span class="cm">,</span> <span class="q">&quot;-&quot;</span><span class="cm">,</span> <span class="q">&quot;-=&quot;</span><span class="cm">,</span> <span class="q">&quot;*&quot;</span><span class="cm">,</span> <span class="q">&quot;*=&quot;</span><span class="cm">,</span> <span class="q">&quot;/&quot;</span><span class="cm">,</span> <span class="q">&quot;/=&quot;</span><span class="cm">,</span> <span class="q">&quot;%&quot;</span><span class="cm">,</span> <span class="q">&quot;%=&quot;</span><span class="cm">,</span></li><li>    <span class="q">&quot;**&quot;</span><span class="cm">,</span> <span class="q">&quot;**=&quot;</span><span class="cm">,</span> <span class="q">&quot;&lt;&lt;&quot;</span><span class="cm">,</span> <span class="q">&quot;&lt;&lt;=&quot;</span><span class="cm">,</span> <span class="q">&quot;&gt;&gt;&quot;</span><span class="cm">,</span> <span class="q">&quot;&gt;&gt;=&quot;</span><span class="cm">,</span> <span class="q">&quot;x&quot;</span><span class="cm">,</span> <span class="q">&quot;x=&quot;</span><span class="cm">,</span> <span class="q">&quot;.&quot;</span><span class="cm">,</span> <span class="q">&quot;.=&quot;</span><span class="cm">,</span></li></ol></pre><p>For these operations a substituted non-assignment variant can be called if
the assignment variant is not available.  Methods for operations <code class="inline">+</code>
,
<code class="inline">-</code>
, <code class="inline">+=</code>
, and <code class="inline">-=</code>
 can be called to automatically generate
increment and decrement methods.  The operation <code class="inline">-</code>
 can be used to
autogenerate missing methods for unary minus or <code class="inline"><a class="l_k" href="functions/abs.html">abs</a></code>.</p>
<p>See <a href="#MAGIC-AUTOGENERATION">MAGIC AUTOGENERATION</a>, <a href="#Calling-Conventions-for-Mutators">Calling Conventions for Mutators</a> and
<a href="#Calling-Conventions-for-Binary-Operations">Calling Conventions for Binary Operations</a>) for details of these
substitutions.</p>
</li>
<li><a name="*-_Comparison-operations_"></a><b><i>Comparison operations</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;&lt;&quot;</span><span class="cm">,</span>  <span class="q">&quot;&lt;=&quot;</span><span class="cm">,</span> <span class="q">&quot;&gt;&quot;</span><span class="cm">,</span>  <span class="q">&quot;&gt;=&quot;</span><span class="cm">,</span> <span class="q">&quot;==&quot;</span><span class="cm">,</span> <span class="q">&quot;!=&quot;</span><span class="cm">,</span> <span class="q">&quot;&lt;=&gt;&quot;</span><span class="cm">,</span></li><li>    <span class="q">&quot;lt&quot;</span><span class="cm">,</span> <span class="q">&quot;le&quot;</span><span class="cm">,</span> <span class="q">&quot;gt&quot;</span><span class="cm">,</span> <span class="q">&quot;ge&quot;</span><span class="cm">,</span> <span class="q">&quot;eq&quot;</span><span class="cm">,</span> <span class="q">&quot;ne&quot;</span><span class="cm">,</span> <span class="q">&quot;cmp&quot;</span><span class="cm">,</span></li></ol></pre><p>If the corresponding "spaceship" variant is available, it can be
used to substitute for the missing operation.  During <code class="inline"><a class="l_k" href="functions/sort.html">sort</a></code>ing
arrays, <code class="inline">cmp</code>
 is used to compare values subject to <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
.</p>
</li>
<li><a name="*-_Bit-operations_"></a><b><i>Bit operations</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;&amp;&quot;</span><span class="cm">,</span> <span class="q">&quot;&amp;=&quot;</span><span class="cm">,</span> <span class="q">&quot;^&quot;</span><span class="cm">,</span> <span class="q">&quot;^=&quot;</span><span class="cm">,</span> <span class="q">&quot;|&quot;</span><span class="cm">,</span> <span class="q">&quot;|=&quot;</span><span class="cm">,</span> <span class="q">&quot;neg&quot;</span><span class="cm">,</span> <span class="q">&quot;!&quot;</span><span class="cm">,</span> <span class="q">&quot;~&quot;</span><span class="cm">,</span></li></ol></pre><p><code class="inline"><span class="w">neg</span></code>
 stands for unary minus.  If the method for <code class="inline"><span class="w">neg</span></code>
 is not
specified, it can be autogenerated using the method for
subtraction. If the method for <code class="inline">!</code>
 is not specified, it can be
autogenerated using the methods for <code class="inline"><span class="w">bool</span></code>
, or <code class="inline"><span class="q">&quot;&quot;</span></code>
, or <code class="inline"><span class="n">0</span>+</code>
.</p>
<p>The same remarks in <a href="#Arithmetic-operations">Arithmetic operations</a> about
assignment-variants and autogeneration apply for
bit operations <code class="inline"><span class="q">&quot;&amp;&quot;</span></code>
, <code class="inline"><span class="q">&quot;^&quot;</span></code>
, and <code class="inline"><span class="q">&quot;|&quot;</span></code>
 as well.</p>
</li>
<li><a name="*-_Increment-and-decrement_"></a><b><i>Increment and decrement</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;++&quot;</span><span class="cm">,</span> <span class="q">&quot;--&quot;</span><span class="cm">,</span></li></ol></pre><p>If undefined, addition and subtraction methods can be
used instead.  These operations are called both in prefix and
postfix form.</p>
</li>
<li><a name="*-_Transcendental-functions_"></a><b><i>Transcendental functions</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;atan2&quot;</span><span class="cm">,</span> <span class="q">&quot;cos&quot;</span><span class="cm">,</span> <span class="q">&quot;sin&quot;</span><span class="cm">,</span> <span class="q">&quot;exp&quot;</span><span class="cm">,</span> <span class="q">&quot;abs&quot;</span><span class="cm">,</span> <span class="q">&quot;log&quot;</span><span class="cm">,</span> <span class="q">&quot;sqrt&quot;</span><span class="cm">,</span> <span class="q">&quot;int&quot;</span></li></ol></pre><p>If <code class="inline"><a class="l_k" href="functions/abs.html">abs</a></code> is unavailable, it can be autogenerated using methods
for "&lt;" or "&lt;=&gt;" combined with either unary minus or subtraction.</p>
<p>Note that traditionally the Perl function <a href="functions/int.html">int</a> rounds to 0, thus for
floating-point-like types one should follow the same semantic.  If
<code class="inline"><a class="l_k" href="functions/int.html">int</a></code> is unavailable, it can be autogenerated using the overloading of
<code class="inline"><span class="n">0</span>+</code>
.</p>
</li>
<li><a name="*-_Boolean%2c-string%2c-numeric-and-regexp-conversions_"></a><b><i>Boolean, string, numeric and regexp conversions</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&#39;bool&#39;</span><span class="cm">,</span> <span class="q">&#39;&quot;&quot;&#39;</span><span class="cm">,</span> <span class="q">&#39;0+&#39;</span><span class="cm">,</span> <span class="q">&#39;qr&#39;</span></li></ol></pre><p>If one or two of these operations are not overloaded, the remaining ones
can be used instead.  <code class="inline"><span class="w">bool</span></code>
 is used in the flow control operators
(like <code class="inline">while</code>
) and for the ternary <code class="inline">?:</code> operation; <code class="inline"><a class="l_k" href="functions/qr.html">qr</a></code> is used for
the RHS of <code class="inline">=~</code>
 and when an object is interpolated into a regexp.</p>
<p><code class="inline"><span class="w">bool</span></code>
, <code class="inline"><span class="q">&quot;&quot;</span></code>
, and <code class="inline"><span class="n">0</span>+</code>
 can return any arbitrary Perl value.  If the
corresponding operation for this value is overloaded too, that operation
will be called again with this value. <code class="inline"><a class="l_k" href="functions/qr.html">qr</a></code> must return a compiled
regexp, or a ref to a compiled regexp (such as <code class="inline"><a class="l_k" href="functions/qr.html">qr//</a></code> returns), and any
further overloading on the return value will be ignored.</p>
<p>As a special case if the overload returns the object itself then it will
be used directly. An overloaded conversion returning the object is
probably a bug, because you're likely to get something that looks like
<code class="inline"><span class="w">YourPackage</span>=<span class="i">HASH</span><span class="s">(</span><span class="n">0x8172b34</span><span class="s">)</span></code>
.</p>
</li>
<li><a name="*-_Iteration_"></a><b><i>Iteration</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;&lt;&gt;&quot;</span></li></ol></pre><p>If not overloaded, the argument will be converted to a filehandle or
glob (which may require a stringification).  The same overloading
happens both for the <i>read-filehandle</i> syntax <code class="inline"><span class="q">&lt;$var&gt;</span></code>
 and
<i>globbing</i> syntax <code class="inline"><span class="q">&lt;${var}&gt;</span></code>
.</p>
<p><b>BUGS</b> Even in list context, the iterator is currently called only
once and with scalar context.</p>
</li>
<li><a name="*-_File-tests_"></a><b><i>File tests</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;-X&quot;</span></li></ol></pre><p>This overload is used for all the filetest operators (<code class="inline">-f</code>
, <code class="inline">-x</code>
 and
so on: see <a href="functions/-X.html">-X</a> for the full list). Even though these are
unary operators, the method will be called with a second argument which
is a single letter indicating which test was performed. Note that the
overload key is the literal string <code class="inline"><span class="q">&quot;-X&quot;</span></code>
: you can't provide separate
overloads for the different tests.</p>
<p>Calling an overloaded filetest operator does not affect the stat value
associated with the special filehandle <code class="inline"><span class="w">_</span></code>
. It still refers to the
result of the last <code class="inline"><a class="l_k" href="functions/stat.html">stat</a></code>, <code class="inline"><a class="l_k" href="functions/lstat.html">lstat</a></code> or unoverloaded filetest.</p>
<p>If not overloaded, these operators will fall back to the default
behaviour even without <code class="inline"><span class="w">fallback</span> <span class="cm">=&gt;</span> <span class="n">1</span></code>
. This means that if the
object is a blessed glob or blessed IO ref it will be treated as a
filehandle, otherwise string overloading will be invoked and the result
treated as a filename.</p>
<p>This overload was introduced in perl 5.12.</p>
</li>
<li><a name="*-_Matching_"></a><b><i>Matching</i></b>
<p>The key <code class="inline"><span class="q">&quot;~~&quot;</span></code>
 allows you to override the smart matching logic used by
the <code class="inline">~~</code>
 operator and the switch construct (<code class="inline">given</code>
/<code class="inline">when</code>
).  See
<a href="perlsyn.html#switch">switch in perlsyn</a> and <a href="feature.html">feature</a>.</p>
<p>Unusually, overloading of the smart match operator does not automatically
take precedence over normal smart match behaviour. In particular, in the
following code:</p>
<pre class="verbatim"><ol><li><a name="package-Foo"></a>    package <span class="i">Foo</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="q">&#39;~~&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;match&#39;</span><span class="sc">;</span></li><li></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$obj</span> =  <span class="w">Foo</span><span class="w">-&gt;new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$obj</span> ~~ <span class="s">[</span> <span class="n">1</span><span class="cm">,</span><span class="n">2</span><span class="cm">,</span><span class="n">3</span> <span class="s">]</span><span class="sc">;</span></li></ol></pre><p>the smart match does <i>not</i> invoke the method call like this:</p>
<pre class="verbatim"><ol><li>    <span class="i">$obj</span><span class="i">-&gt;match</span><span class="s">(</span><span class="s">[</span><span class="n">1</span><span class="cm">,</span><span class="n">2</span><span class="cm">,</span><span class="n">3</span><span class="s">]</span><span class="cm">,</span><span class="n">0</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>rather, the smart match distributive rule takes precedence, so $obj is
smart matched against each array element in turn until a match is found,
so you may see between one and three of these calls instead:</p>
<pre class="verbatim"><ol><li>    <span class="i">$obj</span><span class="i">-&gt;match</span><span class="s">(</span><span class="n">1</span><span class="cm">,</span><span class="n">0</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$obj</span><span class="i">-&gt;match</span><span class="s">(</span><span class="n">2</span><span class="cm">,</span><span class="n">0</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$obj</span><span class="i">-&gt;match</span><span class="s">(</span><span class="n">3</span><span class="cm">,</span><span class="n">0</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Consult the match table in  <a href="perlsyn.html#Smart-matching-in-detail">Smart matching in detail in perlsyn</a> for
details of when overloading is invoked.</p>
</li>
<li><a name="*-_Dereferencing_"></a><b><i>Dereferencing</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&#39;${}&#39;</span><span class="cm">,</span> <span class="q">&#39;@{}&#39;</span><span class="cm">,</span> <span class="q">&#39;%{}&#39;</span><span class="cm">,</span> <span class="q">&#39;&amp;{}&#39;</span><span class="cm">,</span> <span class="q">&#39;*{}&#39;</span>.</li></ol></pre><p>If not overloaded, the argument will be dereferenced <i>as is</i>, thus
should be of correct type.  These functions should return a reference
of correct type, or another object with overloaded dereferencing.</p>
<p>As a special case if the overload returns the object itself then it
will be used directly (provided it is the correct type).</p>
<p>The dereference operators must be specified explicitly they will not be passed to
"nomethod".</p>
</li>
<li><a name="*-_Special_"></a><b><i>Special</i></b>
<pre class="verbatim"><ol><li>    <span class="q">&quot;nomethod&quot;</span><span class="cm">,</span> <span class="q">&quot;fallback&quot;</span><span class="cm">,</span> <span class="q">&quot;=&quot;</span>.</li></ol></pre><p>see <a href="#SPECIAL-SYMBOLS-FOR-use-overload">SPECIAL SYMBOLS FOR use overload</a>.</p>
</li>
</ul>
<p>See <a href="#Fallback">Fallback</a> for an explanation of when a missing method can be
autogenerated.</p>
<p>A computer-readable form of the above table is available in the hash
%overload::ops, with values being space-separated lists of names:</p>
<pre class="verbatim"><ol><li> <span class="w">with_assign</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;+ - * / % ** &lt;&lt; &gt;&gt; x .&#39;</span><span class="cm">,</span></li><li> <span class="w">assign</span>		  <span class="cm">=&gt;</span> <span class="q">&#39;+= -= *= /= %= **= &lt;&lt;= &gt;&gt;= x= .=&#39;</span><span class="cm">,</span></li><li> <span class="w">num_comparison</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;&lt; &lt;= &gt; &gt;= == !=&#39;</span><span class="cm">,</span></li><li> <span class="q">&#39;3way_comparison&#39;</span><span class="cm">=&gt;</span> <span class="q">&#39;&lt;=&gt; cmp&#39;</span><span class="cm">,</span></li><li> <span class="w">str_comparison</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;lt le gt ge eq ne&#39;</span><span class="cm">,</span></li><li> <span class="w">binary</span>		  <span class="cm">=&gt;</span> <span class="q">&#39;&amp; &amp;= | |= ^ ^=&#39;</span><span class="cm">,</span></li><li> <span class="w">unary</span>		  <span class="cm">=&gt;</span> <span class="q">&#39;neg ! ~&#39;</span><span class="cm">,</span></li><li> <span class="w">mutators</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;++ --&#39;</span><span class="cm">,</span></li><li> <span class="w">func</span>		  <span class="cm">=&gt;</span> <span class="q">&#39;atan2 cos sin exp abs log sqrt&#39;</span><span class="cm">,</span></li><li> <span class="w">conversion</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;bool &quot;&quot; 0+ qr&#39;</span><span class="cm">,</span></li><li> <span class="w">iterators</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;&lt;&gt;&#39;</span><span class="cm">,</span></li><li> <span class="w">filetest</span>         <span class="cm">=&gt;</span> <span class="q">&#39;-X&#39;</span><span class="cm">,</span></li><li> <span class="w">dereferencing</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;${} @{} %{} &amp;{} *{}&#39;</span><span class="cm">,</span></li><li> <span class="w">matching</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;~~&#39;</span><span class="cm">,</span></li><li> <span class="w">special</span>	  <span class="cm">=&gt;</span> <span class="q">&#39;nomethod fallback =&#39;</span></li></ol></pre><a name="Inheritance-and-overloading"></a><h2>Inheritance and overloading</h2>
<p>Inheritance interacts with overloading in two ways.</p>
<ul>
<li><a name="Strings-as-values-of-use-overload-directive"></a><b>Strings as values of <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
 directive</b>
<p>If <code class="inline"><span class="w">value</span></code>
 in</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="w">key</span> <span class="cm">=&gt;</span> <span class="w">value</span><span class="sc">;</span></li></ol></pre><p>is a string, it is interpreted as a method name.</p>
</li>
<li><a name="Overloading-of-an-operation-is-inherited-by-derived-classes"></a><b>Overloading of an operation is inherited by derived classes</b>
<p>Any class derived from an overloaded class is also overloaded.  The
set of overloaded methods is the union of overloaded methods of all
the ancestors. If some method is overloaded in several ancestor, then
which description will be used is decided by the usual inheritance
rules:</p>
<p>If <code class="inline"><span class="w">A</span></code>
 inherits from <code class="inline"><span class="w">B</span></code>
 and <code class="inline"><span class="w">C</span></code>
 (in this order), <code class="inline"><span class="w">B</span></code>
 overloads
<code class="inline">+</code>
 with <code class="inline">\<span class="i">&amp;D::plus_sub</span></code>
, and <code class="inline"><span class="w">C</span></code>
 overloads <code class="inline">+</code>
 by <code class="inline"><span class="q">&quot;plus_meth&quot;</span></code>
,
then the subroutine <code class="inline"><span class="w">D::plus_sub</span></code>
 will be called to implement
operation <code class="inline">+</code>
 for an object in package <code class="inline"><span class="w">A</span></code>
.</p>
</li>
</ul>
<p>Note that since the value of the <code class="inline"><span class="w">fallback</span></code>
 key is not a subroutine,
its inheritance is not governed by the above rules.  In the current
implementation, the value of <code class="inline"><span class="w">fallback</span></code>
 in the first overloaded
ancestor is used, but this is accidental and subject to change.</p>
<a name="SPECIAL-SYMBOLS-FOR-use-overload"></a><h1>SPECIAL SYMBOLS FOR <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
</h1>
<p>Three keys are recognized by Perl that are not covered by the above
description.</p>
<a name="Last-Resort"></a><h2>Last Resort</h2>
<p><code class="inline"><span class="q">&quot;nomethod&quot;</span></code>
 should be followed by a reference to a function of four
parameters.  If defined, it is called when the overloading mechanism
cannot find a method for some operation.  The first three arguments of
this function coincide with the arguments for the corresponding method if
it were found, the fourth argument is the symbol
corresponding to the missing method.  If several methods are tried,
the last one is used.  Say, <code class="inline"><span class="n">1</span>-<span class="i">$a</span></code>
 can be equivalent to</p>
<pre class="verbatim"><ol><li>	<span class="i">&amp;nomethodMethod</span><span class="s">(</span><span class="i">$a</span><span class="cm">,</span><span class="n">1</span><span class="cm">,</span><span class="n">1</span><span class="cm">,</span><span class="q">&quot;-&quot;</span><span class="s">)</span></li></ol></pre><p>if the pair <code class="inline"><span class="q">&quot;nomethod&quot;</span> <span class="cm">=&gt;</span> <span class="q">&quot;nomethodMethod&quot;</span></code>
 was specified in the
<code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
 directive.</p>
<p>The <code class="inline"><span class="q">&quot;nomethod&quot;</span></code>
 mechanism is <i>not</i> used for the dereference operators
( ${} @{} %{} &amp;{} *{} ).</p>
<p>If some operation cannot be resolved, and there is no function
assigned to <code class="inline"><span class="q">&quot;nomethod&quot;</span></code>
, then an exception will be raised via die()--
unless <code class="inline"><span class="q">&quot;fallback&quot;</span></code>
 was specified as a key in <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
 directive.</p>
<a name="Fallback"></a><h2>Fallback</h2>
<p>The key <code class="inline"><span class="q">&quot;fallback&quot;</span></code>
 governs what to do if a method for a particular
operation is not found.  Three different cases are possible depending on
the value of <code class="inline"><span class="q">&quot;fallback&quot;</span></code>
:</p>
<ul>
<li><a name="*-undef"></a><b><code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code></b>
<p>Perl tries to use a
substituted method (see <a href="#MAGIC-AUTOGENERATION">MAGIC AUTOGENERATION</a>).  If this fails, it
then tries to calls <code class="inline"><span class="q">&quot;nomethod&quot;</span></code>
 value; if missing, an exception
will be raised.</p>
</li>
<li><a name="*-TRUE"></a><b>TRUE</b>
<p>The same as for the <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code> value, but no exception is raised.  Instead,
it silently reverts to what it would have done were there no <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>

present.</p>
</li>
<li><a name="*-defined%2c-but-FALSE"></a><b>defined, but FALSE</b>
<p>No autogeneration is tried.  Perl tries to call
<code class="inline"><span class="q">&quot;nomethod&quot;</span></code>
 value, and if this is missing, raises an exception.</p>
</li>
</ul>
<p><b>Note.</b> <code class="inline"><span class="q">&quot;fallback&quot;</span></code>
 inheritance via @ISA is not carved in stone
yet, see <a href="#Inheritance-and-overloading">Inheritance and overloading</a>.</p>
<a name="Copy-Constructor"></a><h2>Copy Constructor</h2>
<p>The value for <code class="inline"><span class="q">&quot;=&quot;</span></code>
 is a reference to a function with three
arguments, i.e., it looks like the other values in <code class="inline"><a class="l_k" href="functions/use.html">use</a>
<span class="w">overload</span></code>
. However, it does not overload the Perl assignment
operator. This would go against Camel hair.</p>
<p>This operation is called in the situations when a mutator is applied
to a reference that shares its object with some other reference, such
as</p>
<pre class="verbatim"><ol><li>	<span class="i">$a</span>=<span class="i">$b</span><span class="sc">;</span></li><li>	++<span class="i">$a</span><span class="sc">;</span></li></ol></pre><p>To make this change $a and not change $b, a copy of <code class="inline"><span class="i">$$a</span></code>
 is made,
and $a is assigned a reference to this new object.  This operation is
done during execution of the <code class="inline">++<span class="i">$a</span></code>
, and not during the assignment,
(so before the increment <code class="inline"><span class="i">$$a</span></code>
 coincides with <code class="inline"><span class="i">$$b</span></code>
).  This is only
done if <code class="inline">++</code>
 is expressed via a method for <code class="inline"><span class="q">&#39;++&#39;</span></code>
 or <code class="inline"><span class="q">&#39;+=&#39;</span></code>
 (or
<code class="inline"><span class="w">nomethod</span></code>
).  Note that if this operation is expressed via <code class="inline"><span class="q">&#39;+&#39;</span></code>

a nonmutator, i.e., as in</p>
<pre class="verbatim"><ol><li>	<span class="i">$a</span>=<span class="i">$b</span><span class="sc">;</span></li><li>	<span class="i">$a</span>=<span class="i">$a</span>+<span class="n">1</span><span class="sc">;</span></li></ol></pre><p>then <code class="inline"><span class="i">$a</span></code>
 does not reference a new copy of <code class="inline"><span class="i">$$a</span></code>
, since $$a does not
appear as lvalue when the above code is executed.</p>
<p>If the copy constructor is required during the execution of some mutator,
but a method for <code class="inline"><span class="q">&#39;=&#39;</span></code>
 was not specified, it can be autogenerated as a
string copy if the object is a plain scalar or a simple assignment if it
is not.</p>
<ul>
<li><a name="*Example*"></a><b><b>Example</b></b>
<p>The actually executed code for</p>
<pre class="verbatim"><ol><li>	$a=$b;</li><li>        Something else which does not modify $a or $b....</li><li>	++$a;</li></ol></pre><p>may be</p>
<pre class="verbatim"><ol><li>	$a=$b;</li><li>        Something else which does not modify $a or $b....</li><li>	$a = $a-&gt;clone(undef,"");</li><li>        $a-&gt;incr(undef,"");</li></ol></pre><p>if $b was mathemagical, and <code class="inline"><span class="q">&#39;++&#39;</span></code>
 was overloaded with <code class="inline">\<span class="i">&amp;incr</span></code>
,
<code class="inline"><span class="q">&#39;=&#39;</span></code>
 was overloaded with <code class="inline">\<span class="i">&amp;clone</span></code>
.</p>
</li>
</ul>
<p>Same behaviour is triggered by <code class="inline"><span class="i">$b</span> = <span class="i">$a</span>++</code>
, which is consider a synonym for
<code class="inline"><span class="i">$b</span> = <span class="i">$a</span><span class="sc">;</span> ++<span class="i">$a</span></code>
.</p>
<a name="MAGIC-AUTOGENERATION"></a><h1>MAGIC AUTOGENERATION</h1>
<p>If a method for an operation is not found, and the value for  <code class="inline"><span class="q">&quot;fallback&quot;</span></code>
 is
TRUE or undefined, Perl tries to autogenerate a substitute method for
the missing operation based on the defined operations.  Autogenerated method
substitutions are possible for the following operations:</p>
<ul>
<li><a name="_Assignment-forms-of-arithmetic-operations_"></a><b><i>Assignment forms of arithmetic operations</i></b>
<p><code class="inline"><span class="i">$a</span>+=<span class="i">$b</span></code>
 can use the method for <code class="inline"><span class="q">&quot;+&quot;</span></code>
 if the method for <code class="inline"><span class="q">&quot;+=&quot;</span></code>

is not defined.</p>
</li>
<li><a name="_Conversion-operations_"></a><b><i>Conversion operations</i></b>
<p>String, numeric, boolean and regexp conversions are calculated in terms
of one another if not all of them are defined.</p>
</li>
<li><a name="_Increment-and-decrement_"></a><b><i>Increment and decrement</i></b>
<p>The <code class="inline">++<span class="i">$a</span></code>
 operation can be expressed in terms of <code class="inline"><span class="i">$a</span>+=<span class="n">1</span></code>
 or <code class="inline"><span class="i">$a</span>+<span class="n">1</span></code>
,
and <code class="inline"><span class="i">$a</span>--</code>
 in terms of <code class="inline"><span class="i">$a</span>-=<span class="n">1</span></code>
 and <code class="inline"><span class="i">$a</span>-<span class="n">1</span></code>
.</p>
</li>
<li><a name="abs(%24a)"></a><b><code class="inline"><a class="l_k" href="functions/abs.html">abs($a)</a></code></b>
<p>can be expressed in terms of <code class="inline"><span class="i">$a</span>&lt;<span class="n">0</span></code>
 and <code class="inline">-<span class="i">$a</span></code>
 (or <code class="inline"><span class="n">0</span>-<span class="i">$a</span></code>
).</p>
</li>
<li><a name="_Unary-minus_"></a><b><i>Unary minus</i></b>
<p>can be expressed in terms of subtraction.</p>
</li>
<li><a name="_Negation_"></a><b><i>Negation</i></b>
<p><code class="inline">!</code>
 and <code class="inline">not</code>
 can be expressed in terms of boolean conversion, or
string or numerical conversion.</p>
</li>
<li><a name="_Concatenation_"></a><b><i>Concatenation</i></b>
<p>can be expressed in terms of string conversion.</p>
</li>
<li><a name="_Comparison-operations_"></a><b><i>Comparison operations</i></b>
<p>can be expressed in terms of its "spaceship" counterpart: either
<code class="inline">&lt;=&gt;</code>
 or <code class="inline">cmp</code>
:</p>
<pre class="verbatim"><ol><li>    <span class="q">&lt;, &gt;</span><span class="cm">,</span> &lt;=<span class="cm">,</span> &gt;=<span class="cm">,</span> ==<span class="cm">,</span> != 	<span class="w">in</span> <span class="w">terms</span> <span class="w">of</span> &lt;=&gt;</li><li>    lt<span class="cm">,</span> gt<span class="cm">,</span> le<span class="cm">,</span> ge<span class="cm">,</span> eq<span class="cm">,</span> ne 	<span class="w">in</span> <span class="w">terms</span> <span class="w">of</span> cmp</li></ol></pre></li>
<li><a name="_Iterator_"></a><b><i>Iterator</i></b>
<pre class="verbatim"><ol><li>    &lt;&gt;				in terms of builtin operations</li></ol></pre></li>
<li><a name="_Dereferencing_"></a><b><i>Dereferencing</i></b>
<pre class="verbatim"><ol><li>    ${} @{} %{} &amp;{} *{}		in terms of builtin operations</li></ol></pre></li>
<li><a name="_Copy-operator_"></a><b><i>Copy operator</i></b>
<p>can be expressed in terms of an assignment to the dereferenced value, if this
value is a scalar and not a reference, or simply a reference assignment
otherwise.</p>
</li>
</ul>
<a name="Minimal-set-of-overloaded-operations"></a><h1>Minimal set of overloaded operations</h1>
<p>Since some operations can be automatically generated from others, there is
a minimal set of operations that need to be overloaded in order to have
the complete set of overloaded operations at one's disposal.
Of course, the autogenerated operations may not do exactly what the user
expects. See <a href="#MAGIC-AUTOGENERATION">MAGIC AUTOGENERATION</a> above. The minimal set is:</p>
<pre class="verbatim"><ol><li>    + - <span class="i">* /</span> % <span class="i">**</span> &lt;&lt; &gt;&gt; <span class="w">x</span></li><li>    &lt;=&gt; cmp</li><li>    <span class="i">&amp; |</span> ^ ~</li><li>    <a class="l_k" href="functions/atan2.html">atan2</a> <a class="l_k" href="functions/cos.html">cos</a> <a class="l_k" href="functions/sin.html">sin</a> <a class="l_k" href="functions/exp.html">exp</a> <a class="l_k" href="functions/log.html">log</a> <a class="l_k" href="functions/sqrt.html">sqrt</a> <a class="l_k" href="functions/int.html">int</a></li></ol></pre><p>Additionally, you need to define at least one of string, boolean or
numeric conversions because any one can be used to emulate the others.
The string conversion can also be used to emulate concatenation.</p>
<a name="Losing-overloading"></a><h1>Losing overloading</h1>
<p>The restriction for the comparison operation is that even if, for example,
`<code class="inline">cmp</code>
' should return a blessed reference, the autogenerated `<code class="inline">lt</code>
'
function will produce only a standard logical value based on the
numerical value of the result of `<code class="inline">cmp</code>
'.  In particular, a working
numeric conversion is needed in this case (possibly expressed in terms of
other conversions).</p>
<p>Similarly, <code class="inline">.=</code>
  and <code class="inline"><span class="w">x</span>=</code>
 operators lose their mathemagical properties
if the string conversion substitution is applied.</p>
<p>When you chop() a mathemagical object it is promoted to a string and its
mathemagical properties are lost.  The same can happen with other
operations as well.</p>
<a name="Run-time-Overloading"></a><h1>Run-time Overloading</h1>
<p>Since all <code class="inline"><a class="l_k" href="functions/use.html">use</a></code> directives are executed at compile-time, the only way to
change overloading during run-time is to</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&#39;use overload &quot;+&quot; =&gt; \&amp;addmethod&#39;</span><span class="sc">;</span></li></ol></pre><p>You can also use</p>
<pre class="verbatim"><ol><li>    <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&#39;no overload &quot;+&quot;, &quot;--&quot;, &quot;&lt;=&quot;&#39;</span><span class="sc">;</span></li></ol></pre><p>though the use of these constructs during run-time is questionable.</p>
<a name="Public-functions"></a><h1>Public functions</h1>
<p>Package <code class="inline"><span class="w">overload</span>.<span class="w">pm</span></code>
 provides the following public functions:</p>
<ul>
<li><a name="overload%3a%3aStrVal(arg)"></a><b>overload::StrVal(arg)</b>
<p>Gives string value of <code class="inline"><span class="w">arg</span></code>
 as in absence of stringify overloading. If you
are using this to get the address of a reference (useful for checking if two
references point to the same thing) then you may be better off using
<code class="inline"><span class="i">Scalar::Util::refaddr</span><span class="s">(</span><span class="s">)</span></code>
, which is faster.</p>
</li>
<li><a name="overload%3a%3aOverloaded(arg)"></a><b>overload::Overloaded(arg)</b>
<p>Returns true if <code class="inline"><span class="w">arg</span></code>
 is subject to overloading of some operations.</p>
</li>
<li><a name="overload%3a%3aMethod(obj%2cop)"></a><b>overload::Method(obj,op)</b>
<p>Returns <code class="inline"><a class="l_k" href="functions/undef.html">undef</a></code> or a reference to the method that implements <code class="inline"><span class="w">op</span></code>
.</p>
</li>
</ul>
<a name="Overloading-constants"></a><h1>Overloading constants</h1>
<p>For some applications, the Perl parser mangles constants too much.
It is possible to hook into this process via <code class="inline"><span class="i">overload::constant</span><span class="s">(</span><span class="s">)</span></code>

and <code class="inline"><span class="i">overload::remove_constant</span><span class="s">(</span><span class="s">)</span></code>
 functions.</p>
<p>These functions take a hash as an argument.  The recognized keys of this hash
are:</p>
<ul>
<li><a name="integer"></a><b>integer</b>
<p>to overload integer constants,</p>
</li>
<li><a name="float"></a><b>float</b>
<p>to overload floating point constants,</p>
</li>
<li><a name="binary"></a><b>binary</b>
<p>to overload octal and hexadecimal constants,</p>
</li>
<li><a name="q"></a><b>q</b>
<p>to overload <code class="inline"><a class="l_k" href="functions/q.html">q</a></code>-quoted strings, constant pieces of <code class="inline"><a class="l_k" href="functions/qq.html">qq</a></code>- and <code class="inline"><a class="l_k" href="functions/qx.html">qx</a></code>-quoted
strings and here-documents,</p>
</li>
<li><a name="qr"></a><b>qr</b>
<p>to overload constant pieces of regular expressions.</p>
</li>
</ul>
<p>The corresponding values are references to functions which take three arguments:
the first one is the <i>initial</i> string form of the constant, the second one
is how Perl interprets this constant, the third one is how the constant is used.
Note that the initial string form does not
contain string delimiters, and has backslashes in backslash-delimiter
combinations stripped (thus the value of delimiter is not relevant for
processing of this string).  The return value of this function is how this
constant is going to be interpreted by Perl.  The third argument is undefined
unless for overloaded <code class="inline"><a class="l_k" href="functions/q.html">q</a></code>- and <code class="inline"><a class="l_k" href="functions/qr.html">qr</a></code>- constants, it is <code class="inline"><a class="l_k" href="functions/q.html">q</a></code> in single-quote
context (comes from strings, regular expressions, and single-quote HERE
documents), it is <code class="inline"><a class="l_k" href="functions/tr.html">tr</a></code> for arguments of <code class="inline"><a class="l_k" href="functions/tr.html">tr</a></code>/<code class="inline"><a class="l_k" href="functions/y.html">y</a></code> operators,
it is <code class="inline"><a class="l_k" href="functions/s.html">s</a></code> for right-hand side of <code class="inline"><a class="l_k" href="functions/s.html">s</a></code>-operator, and it is <code class="inline"><a class="l_k" href="functions/qq.html">qq</a></code> otherwise.</p>
<p>Since an expression <code class="inline"><span class="q">&quot;ab$cd,,&quot;</span></code>
 is just a shortcut for <code class="inline"><span class="q">&#39;ab&#39;</span> . <span class="i">$cd</span> . <span class="q">&#39;,,&#39;</span></code>
,
it is expected that overloaded constant strings are equipped with reasonable
overloaded catenation operator, otherwise absurd results will result.
Similarly, negative numbers are considered as negations of positive constants.</p>
<p>Note that it is probably meaningless to call the functions overload::constant()
and overload::remove_constant() from anywhere but import() and unimport() methods.
From these methods they may be called as</p>
<pre class="verbatim"><ol><li><a name="import"></a>	sub <span class="m">import</span> <span class="s">{</span></li><li>	  <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>	  <a class="l_k" href="functions/return.html">return</a> unless <span class="i">@_</span><span class="sc">;</span></li><li>	  <a class="l_k" href="functions/die.html">die</a> <span class="q">&quot;unknown import: @_&quot;</span> unless <span class="i">@_</span> == <span class="n">1</span> and <span class="i">$_</span>[<span class="n">0</span>] eq <span class="q">&#39;:constant&#39;</span><span class="sc">;</span></li><li>	  <span class="w">overload::constant</span> <span class="w">integer</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><span class="w">Math::BigInt</span><span class="w">-&gt;new</span><span class="s">(</span><a class="l_k" href="functions/shift.html">shift</a><span class="s">)</span><span class="s">}</span><span class="sc">;</span></li><li>	<span class="s">}</span></li></ol></pre><a name="IMPLEMENTATION"></a><h1>IMPLEMENTATION</h1>
<p>What follows is subject to change RSN.</p>
<p>The table of methods for all operations is cached in magic for the
symbol table hash for the package.  The cache is invalidated during
processing of <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
, <code class="inline"><a class="l_k" href="functions/no.html">no</a> <span class="w">overload</span></code>
, new function
definitions, and changes in @ISA. However, this invalidation remains
unprocessed until the next <code class="inline"><a class="l_k" href="functions/bless.html">bless</a></code>ing into the package. Hence if you
want to change overloading structure dynamically, you'll need an
additional (fake) <code class="inline"><a class="l_k" href="functions/bless.html">bless</a></code>ing to update the table.</p>
<p>(Every SVish thing has a magic queue, and magic is an entry in that
queue.  This is how a single variable may participate in multiple
forms of magic simultaneously.  For instance, environment variables
regularly have two forms at once: their %ENV magic and their taint
magic. However, the magic which implements overloading is applied to
the stashes, which are rarely used directly, thus should not slow down
Perl.)</p>
<p>If an object belongs to a package using overload, it carries a special
flag.  Thus the only speed penalty during arithmetic operations without
overloading is the checking of this flag.</p>
<p>In fact, if <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
 is not present, there is almost no overhead
for overloadable operations, so most programs should not suffer
measurable performance penalties.  A considerable effort was made to
minimize the overhead when overload is used in some package, but the
arguments in question do not belong to packages using overload.  When
in doubt, test your speed with <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>
 and without it.  So far
there have been no reports of substantial speed degradation if Perl is
compiled with optimization turned on.</p>
<p>There is no size penalty for data if overload is not used. The only
size penalty if overload is used in some package is that <i>all</i> the
packages acquire a magic during the next <code class="inline"><a class="l_k" href="functions/bless.html">bless</a></code>ing into the
package. This magic is three-words-long for packages without
overloading, and carries the cache table if the package is overloaded.</p>
<p>Copying (<code class="inline"><span class="i">$a</span>=<span class="i">$b</span></code>
) is shallow; however, a one-level-deep copying is
carried out before any operation that can imply an assignment to the
object $a (or $b) refers to, like <code class="inline"><span class="i">$a</span>++</code>
.  You can override this
behavior by defining your own copy constructor (see <a href="#Copy-Constructor">Copy Constructor</a>).</p>
<p>It is expected that arguments to methods that are not explicitly supposed
to be changed are constant (but this is not enforced).</p>
<a name="Metaphor-clash"></a><h1>Metaphor clash</h1>
<p>One may wonder why the semantic of overloaded <code class="inline">=</code>
 is so counter intuitive.
If it <i>looks</i> counter intuitive to you, you are subject to a metaphor
clash.</p>
<p>Here is a Perl object metaphor:</p>
<p><i>  object is a reference to blessed data</i></p>
<p>and an arithmetic metaphor:</p>
<p><i>  object is a thing by itself</i>.</p>
<p>The <i>main</i> problem of overloading <code class="inline">=</code>
 is the fact that these metaphors
imply different actions on the assignment <code class="inline"><span class="i">$a</span> = <span class="i">$b</span></code>
 if $a and $b are
objects.  Perl-think implies that $a becomes a reference to whatever
$b was referencing.  Arithmetic-think implies that the value of "object"
$a is changed to become the value of the object $b, preserving the fact
that $a and $b are separate entities.</p>
<p>The difference is not relevant in the absence of mutators.  After
a Perl-way assignment an operation which mutates the data referenced by $a
would change the data referenced by $b too.  Effectively, after
<code class="inline"><span class="i">$a</span> = <span class="i">$b</span></code>
 values of $a and $b become <i>indistinguishable</i>.</p>
<p>On the other hand, anyone who has used algebraic notation knows the
expressive power of the arithmetic metaphor.  Overloading works hard
to enable this metaphor while preserving the Perlian way as far as
possible.  Since it is not possible to freely mix two contradicting
metaphors, overloading allows the arithmetic way to write things <i>as
far as all the mutators are called via overloaded access only</i>.  The
way it is done is described in <a href="#Copy-Constructor">Copy Constructor</a>.</p>
<p>If some mutator methods are directly applied to the overloaded values,
one may need to <i>explicitly unlink</i> other values which references the
same value:</p>
<pre class="verbatim"><ol><li>    <span class="i">$a</span> = <span class="w">Data</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">23</span><span class="s">)</span><span class="sc">;</span></li><li>    ...</li><li>    <span class="i">$b</span> = <span class="i">$a</span><span class="sc">;</span>		<span class="c"># $b is &quot;linked&quot; to $a</span></li><li>    ...</li><li>    <span class="i">$a</span> = <span class="i">$a</span><span class="i">-&gt;clone</span><span class="sc">;</span>	<span class="c"># Unlink $b from $a</span></li><li>    <span class="i">$a</span><span class="i">-&gt;increment_by</span><span class="s">(</span><span class="n">4</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Note that overloaded access makes this transparent:</p>
<pre class="verbatim"><ol><li>    <span class="i">$a</span> = <span class="w">Data</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">23</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$b</span> = <span class="i">$a</span><span class="sc">;</span>		<span class="c"># $b is &quot;linked&quot; to $a</span></li><li>    <span class="i">$a</span> += <span class="n">4</span><span class="sc">;</span>		<span class="c"># would unlink $b automagically</span></li></ol></pre><p>However, it would not make</p>
<pre class="verbatim"><ol><li>    <span class="i">$a</span> = <span class="w">Data</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">23</span><span class="s">)</span><span class="sc">;</span></li><li>    <span class="i">$a</span> = <span class="n">4</span><span class="sc">;</span>		<span class="c"># Now $a is a plain 4, not &#39;Data&#39;</span></li></ol></pre><p>preserve "objectness" of $a.  But Perl <i>has</i> a way to make assignments
to an object do whatever you want.  It is just not the overload, but
tie()ing interface (see <a href="functions/tie.html">tie</a>).  Adding a FETCH() method
which returns the object itself, and STORE() method which changes the
value of the object, one can reproduce the arithmetic metaphor in its
completeness, at least for variables which were tie()d from the start.</p>
<p>(Note that a workaround for a bug may be needed, see <a href="#BUGS">BUGS</a>.)</p>
<a name="Cookbook"></a><h1>Cookbook</h1>
<p>Please add examples to what follows!</p>
<a name="Two-face-scalars"></a><h2>Two-face scalars</h2>
<p>Put this in <i>two_face.pm</i> in your Perl library directory:</p>
<pre class="verbatim"><ol><li><a name="package-two_face"></a>  package <span class="i">two_face</span><span class="sc">;</span>		<span class="c"># Scalars with separate string and</span></li><li>                                <span class="c"># numeric values.</span></li><li><a name="new"></a>  sub <span class="m">new</span> <span class="s">{</span> <a class="l_k" href="functions/my.html">my</a> <span class="i">$p</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span> <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="i">@_</span><span class="s">]</span><span class="cm">,</span> <span class="i">$p</span> <span class="s">}</span></li><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;str</span><span class="cm">,</span> <span class="q">&#39;0+&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;num</span><span class="cm">,</span> <span class="w">fallback</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="sc">;</span></li><li><a name="num"></a>  sub <span class="m">num</span> <span class="s">{</span><a class="l_k" href="functions/shift.html">shift</a>-&gt;[<span class="n">1</span>]<span class="s">}</span></li><li><a name="str"></a>  sub <span class="m">str</span> <span class="s">{</span><a class="l_k" href="functions/shift.html">shift</a>-&gt;[<span class="n">0</span>]<span class="s">}</span></li></ol></pre><p>Use it as follows:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/require.html">require</a> <span class="w">two_face</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$seven</span> = <span class="w">two_face</span><span class="w">-&gt;new</span><span class="s">(</span><span class="q">&quot;vii&quot;</span><span class="cm">,</span> <span class="n">7</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/printf.html">printf</a> <span class="q">&quot;seven=$seven, seven=%d, eight=%d\n&quot;</span><span class="cm">,</span> <span class="i">$seven</span><span class="cm">,</span> <span class="i">$seven</span>+<span class="n">1</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;seven contains `i&#39;\n&quot;</span> if <span class="i">$seven</span> =~ <span class="q">/i/</span><span class="sc">;</span></li></ol></pre><p>(The second line creates a scalar which has both a string value, and a
numeric value.)  This prints:</p>
<pre class="verbatim"><ol><li>  seven=vii, seven=7, eight=8</li><li>  seven contains `i'</li></ol></pre><a name="Two-face-references"></a><h2>Two-face references</h2>
<p>Suppose you want to create an object which is accessible as both an
array reference and a hash reference.</p>
<pre class="verbatim"><ol><li><a name="package-two_refs"></a>  package <span class="i">two_refs</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="q">&#39;%{}&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;gethash</span><span class="cm">,</span> <span class="q">&#39;@{}&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> <span class="i">$</span> {<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>} <span class="s">}</span><span class="sc">;</span></li><li><a name="new"></a>  sub <span class="m">new</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$p</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>    <a class="l_k" href="functions/bless.html">bless</a> \ <span class="s">[</span><span class="i">@_</span><span class="s">]</span><span class="cm">,</span> <span class="i">$p</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li><a name="gethash"></a>  sub <span class="m">gethash</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">%h</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$self</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>    <a class="l_k" href="functions/tie.html">tie</a> <span class="i">%h</span><span class="cm">,</span> <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$self</span><span class="cm">,</span> <span class="i">$self</span><span class="sc">;</span></li><li>    \<span class="i">%h</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li></li><li><a name="TIEHASH"></a>  sub <span class="m">TIEHASH</span> <span class="s">{</span> <a class="l_k" href="functions/my.html">my</a> <span class="i">$p</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span> <a class="l_k" href="functions/bless.html">bless</a> \ <a class="l_k" href="functions/shift.html">shift</a><span class="cm">,</span> <span class="i">$p</span> <span class="s">}</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">%fields</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$i</span> = <span class="n">0</span><span class="sc">;</span></li><li>  <span class="i">$fields</span>{<span class="i">$_</span>} = <span class="i">$i</span>++ foreach <span class="q">qw{zero one two three}</span><span class="sc">;</span></li><li><a name="STORE"></a>  sub <span class="m">STORE</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$self</span> = <span class="i">$</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$key</span> = <span class="i">$fields</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$key</span> or <a class="l_k" href="functions/die.html">die</a> <span class="q">&quot;Out of band access&quot;</span><span class="sc">;</span></li><li>    <span class="i">$$self</span>-&gt;[<span class="i">$key</span>] = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>  <span class="s">}</span></li><li><a name="FETCH"></a>  sub <span class="m">FETCH</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$self</span> = <span class="i">$</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$key</span> = <span class="i">$fields</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$key</span> or <a class="l_k" href="functions/die.html">die</a> <span class="q">&quot;Out of band access&quot;</span><span class="sc">;</span></li><li>    <span class="i">$$self</span>-&gt;[<span class="i">$key</span>]<span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>Now one can access an object using both the array and hash syntax:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$bar</span> = <span class="w">two_refs</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">3</span><span class="cm">,</span><span class="n">4</span><span class="cm">,</span><span class="n">5</span><span class="cm">,</span><span class="n">6</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="i">$bar</span>-&gt;[<span class="n">2</span>] = <span class="n">11</span><span class="sc">;</span></li><li>  <span class="i">$bar</span>-&gt;{<span class="w">two</span>} == <span class="n">11</span> or <a class="l_k" href="functions/die.html">die</a> <span class="q">&#39;bad hash fetch&#39;</span><span class="sc">;</span></li></ol></pre><p>Note several important features of this example.  First of all, the
<i>actual</i> type of $bar is a scalar reference, and we do not overload
the scalar dereference.  Thus we can get the <i>actual</i> non-overloaded
contents of $bar by just using <code class="inline"><span class="i">$$bar</span></code>
 (what we do in functions which
overload dereference).  Similarly, the object returned by the
TIEHASH() method is a scalar reference.</p>
<p>Second, we create a new tied hash each time the hash syntax is used.
This allows us not to worry about a possibility of a reference loop,
which would lead to a memory leak.</p>
<p>Both these problems can be cured.  Say, if we want to overload hash
dereference on a reference to an object which is <i>implemented</i> as a
hash itself, the only problem one has to circumvent is how to access
this <i>actual</i> hash (as opposed to the <i>virtual</i> hash exhibited by the
overloaded dereference operator).  Here is one possible fetching routine:</p>
<pre class="verbatim"><ol><li><a name="access_hash"></a>  sub <span class="m">access_hash</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$self</span><span class="cm">,</span> <span class="i">$key</span><span class="s">)</span> = <span class="s">(</span><a class="l_k" href="functions/shift.html">shift</a><span class="cm">,</span> <a class="l_k" href="functions/shift.html">shift</a><span class="s">)</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$class</span> = <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$self</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/bless.html">bless</a> <span class="i">$self</span><span class="cm">,</span> <span class="q">&#39;overload::dummy&#39;</span><span class="sc">;</span> <span class="c"># Disable overloading of %{}</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$out</span> = <span class="i">$self</span>-&gt;{<span class="i">$key</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/bless.html">bless</a> <span class="i">$self</span><span class="cm">,</span> <span class="i">$class</span><span class="sc">;</span>	<span class="c"># Restore overloading</span></li><li>    <span class="i">$out</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>To remove creation of the tied hash on each access, one may an extra
level of indirection which allows a non-circular structure of references:</p>
<pre class="verbatim"><ol><li><a name="package-two_refs1"></a>  package <span class="i">two_refs1</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="q">&#39;%{}&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> <span class="i">$</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}-&gt;[<span class="n">1</span>] <span class="s">}</span><span class="cm">,</span></li><li>               <span class="q">&#39;@{}&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span> <span class="i">$</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}-&gt;[<span class="n">0</span>] <span class="s">}</span><span class="sc">;</span></li><li><a name="new"></a>  sub <span class="m">new</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$p</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$a</span> = <span class="s">[</span><span class="i">@_</span><span class="s">]</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">%h</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/tie.html">tie</a> <span class="i">%h</span><span class="cm">,</span> <span class="i">$p</span><span class="cm">,</span> <span class="i">$a</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/bless.html">bless</a> \ <span class="s">[</span><span class="i">$a</span><span class="cm">,</span> \<span class="i">%h</span><span class="s">]</span><span class="cm">,</span> <span class="i">$p</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li><a name="gethash"></a>  sub <span class="m">gethash</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">%h</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$self</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>    <a class="l_k" href="functions/tie.html">tie</a> <span class="i">%h</span><span class="cm">,</span> <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$self</span><span class="cm">,</span> <span class="i">$self</span><span class="sc">;</span></li><li>    \<span class="i">%h</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li></li><li><a name="TIEHASH"></a>  sub <span class="m">TIEHASH</span> <span class="s">{</span> <a class="l_k" href="functions/my.html">my</a> <span class="i">$p</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span> <a class="l_k" href="functions/bless.html">bless</a> \ <a class="l_k" href="functions/shift.html">shift</a><span class="cm">,</span> <span class="i">$p</span> <span class="s">}</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">%fields</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$i</span> = <span class="n">0</span><span class="sc">;</span></li><li>  <span class="i">$fields</span>{<span class="i">$_</span>} = <span class="i">$i</span>++ foreach <span class="q">qw{zero one two three}</span><span class="sc">;</span></li><li><a name="STORE"></a>  sub <span class="m">STORE</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$a</span> = <span class="i">$</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$key</span> = <span class="i">$fields</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$key</span> or <a class="l_k" href="functions/die.html">die</a> <span class="q">&quot;Out of band access&quot;</span><span class="sc">;</span></li><li>    <span class="i">$a</span>-&gt;[<span class="i">$key</span>] = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>  <span class="s">}</span></li><li><a name="FETCH"></a>  sub <span class="m">FETCH</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$a</span> = <span class="i">$</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$key</span> = <span class="i">$fields</span>{<a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$key</span> or <a class="l_k" href="functions/die.html">die</a> <span class="q">&quot;Out of band access&quot;</span><span class="sc">;</span></li><li>    <span class="i">$a</span>-&gt;[<span class="i">$key</span>]<span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>Now if $baz is overloaded like this, then <code class="inline"><span class="i">$baz</span></code>
 is a reference to a
reference to the intermediate array, which keeps a reference to an
actual array, and the access hash.  The tie()ing object for the access
hash is a reference to a reference to the actual array, so</p>
<ul>
<li>
<p>There are no loops of references.</p>
</li>
<li>
<p>Both "objects" which are blessed into the class <code class="inline"><span class="w">two_refs1</span></code>
 are
references to a reference to an array, thus references to a <i>scalar</i>.
Thus the accessor expression <code class="inline"><span class="i">$$foo</span>-&gt;[<span class="i">$ind</span>]</code>
 involves no
overloaded operations.</p>
</li>
</ul>
<a name="Symbolic-calculator"></a><h2>Symbolic calculator</h2>
<p>Put this in <i>symbolic.pm</i> in your Perl library directory:</p>
<pre class="verbatim"><ol><li><a name="package-symbolic"></a>  package <span class="i">symbolic</span><span class="sc">;</span>		<span class="c"># Primitive symbolic calculator</span></li><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="w">nomethod</span> <span class="cm">=&gt;</span> \<span class="i">&amp;wrap</span><span class="sc">;</span></li><li></li><li><a name="new"></a>  sub <span class="m">new</span> <span class="s">{</span> <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span> <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="q">&#39;n&#39;</span><span class="cm">,</span> <span class="i">@_</span><span class="s">]</span> <span class="s">}</span></li><li><a name="wrap"></a>  sub <span class="m">wrap</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$obj</span><span class="cm">,</span> <span class="i">$other</span><span class="cm">,</span> <span class="i">$inv</span><span class="cm">,</span> <span class="i">$meth</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span></li><li>    <span class="s">(</span><span class="i">$obj</span><span class="cm">,</span> <span class="i">$other</span><span class="s">)</span> = <span class="s">(</span><span class="i">$other</span><span class="cm">,</span> <span class="i">$obj</span><span class="s">)</span> if <span class="i">$inv</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="i">$meth</span><span class="cm">,</span> <span class="i">$obj</span><span class="cm">,</span> <span class="i">$other</span><span class="s">]</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>This module is very unusual as overloaded modules go: it does not
provide any usual overloaded operators, instead it provides the <a href="#Last-Resort">Last Resort</a> operator <code class="inline"><span class="w">nomethod</span></code>
.  In this example the corresponding
subroutine returns an object which encapsulates operations done over
the objects: <code class="inline"><span class="w">symbolic</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">3</span><span class="s">)</span></code>
 contains <code class="inline"><span class="s">[</span><span class="q">&#39;n&#39;</span><span class="cm">,</span> <span class="n">3</span><span class="s">]</span></code>
, <code class="inline"><span class="n">2</span> +
<span class="w">symbolic</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">3</span><span class="s">)</span></code>
 contains <code class="inline"><span class="s">[</span><span class="q">&#39;+&#39;</span><span class="cm">,</span> <span class="n">2</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;n&#39;</span><span class="cm">,</span> <span class="n">3</span><span class="s">]</span><span class="s">]</span></code>
.</p>
<p>Here is an example of the script which "calculates" the side of
circumscribed octagon using the above package:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/require.html">require</a> <span class="w">symbolic</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$iter</span> = <span class="n">1</span><span class="sc">;</span>			<span class="c"># 2**($iter+2) = 8</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$side</span> = <span class="w">symbolic</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$cnt</span> = <span class="i">$iter</span><span class="sc">;</span></li><li></li><li>  while <span class="s">(</span><span class="i">$cnt</span>--<span class="s">)</span> <span class="s">{</span></li><li>    <span class="i">$side</span> = <span class="s">(</span><a class="l_k" href="functions/sqrt.html">sqrt</a><span class="s">(</span><span class="n">1</span> + <span class="i">$side</span>**<span class="n">2</span><span class="s">)</span> - <span class="n">1</span><span class="s">)</span>/<span class="i">$side</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;OK\n&quot;</span><span class="sc">;</span></li></ol></pre><p>The value of $side is</p>
<pre class="verbatim"><ol><li>  <span class="s">[</span><span class="q">&#39;/&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;sqrt&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;+&#39;</span><span class="cm">,</span> <span class="n">1</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;**&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;n&#39;</span><span class="cm">,</span> <span class="n">1</span><span class="s">]</span><span class="cm">,</span> <span class="n">2</span><span class="s">]</span><span class="s">]</span><span class="cm">,</span></li><li>	               <a class="l_k" href="functions/undef.html">undef</a><span class="s">]</span><span class="cm">,</span> <span class="n">1</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;n&#39;</span><span class="cm">,</span> <span class="n">1</span><span class="s">]</span><span class="s">]</span></li></ol></pre><p>Note that while we obtained this value using a nice little script,
there is no simple way to <i>use</i> this value.  In fact this value may
be inspected in debugger (see <a href="perldebug.html">perldebug</a>), but only if
<code class="inline"><span class="w">bareStringify</span></code>
 <b>O</b>ption is set, and not via <code class="inline"><span class="w">p</span></code>
 command.</p>
<p>If one attempts to print this value, then the overloaded operator
<code class="inline"><span class="q">&quot;&quot;</span></code>
 will be called, which will call <code class="inline"><span class="w">nomethod</span></code>
 operator.  The
result of this operator will be stringified again, but this result is
again of type <code class="inline"><span class="w">symbolic</span></code>
, which will lead to an infinite loop.</p>
<p>Add a pretty-printer method to the module <i>symbolic.pm</i>:</p>
<pre class="verbatim"><ol><li><a name="pretty"></a>  sub <span class="m">pretty</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$meth</span><span class="cm">,</span> <span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span><span class="s">)</span> = <span class="i">@</span>{+<a class="l_k" href="functions/shift.html">shift</a>}<span class="sc">;</span></li><li>    <span class="i">$a</span> = <span class="q">&#39;u&#39;</span> unless <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$a</span><span class="sc">;</span></li><li>    <span class="i">$b</span> = <span class="q">&#39;u&#39;</span> unless <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$b</span><span class="sc">;</span></li><li>    <span class="i">$a</span> = <span class="i">$a</span><span class="i">-&gt;pretty</span> if <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$a</span><span class="sc">;</span></li><li>    <span class="i">$b</span> = <span class="i">$b</span><span class="i">-&gt;pretty</span> if <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$b</span><span class="sc">;</span></li><li>    <span class="q">&quot;[$meth $a $b]&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>Now one can finish the script by</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;side = &quot;</span><span class="cm">,</span> <span class="i">$side</span><span class="i">-&gt;pretty</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span></li></ol></pre><p>The method <code class="inline"><span class="w">pretty</span></code>
 is doing object-to-string conversion, so it
is natural to overload the operator <code class="inline"><span class="q">&quot;&quot;</span></code>
 using this method.  However,
inside such a method it is not necessary to pretty-print the
<i>components</i> $a and $b of an object.  In the above subroutine
<code class="inline"><span class="q">&quot;[$meth $a $b]&quot;</span></code>
 is a catenation of some strings and components $a
and $b.  If these components use overloading, the catenation operator
will look for an overloaded operator <code class="inline">.</code>; if not present, it will
look for an overloaded operator <code class="inline"><span class="q">&quot;&quot;</span></code>
.  Thus it is enough to use</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span> <span class="w">nomethod</span> <span class="cm">=&gt;</span> \<span class="i">&amp;wrap</span><span class="cm">,</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;str</span><span class="sc">;</span></li><li><a name="str"></a>  sub <span class="m">str</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$meth</span><span class="cm">,</span> <span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span><span class="s">)</span> = <span class="i">@</span>{+<a class="l_k" href="functions/shift.html">shift</a>}<span class="sc">;</span></li><li>    <span class="i">$a</span> = <span class="q">&#39;u&#39;</span> unless <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$a</span><span class="sc">;</span></li><li>    <span class="i">$b</span> = <span class="q">&#39;u&#39;</span> unless <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$b</span><span class="sc">;</span></li><li>    <span class="q">&quot;[$meth $a $b]&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>Now one can change the last line of the script to</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;side = $side\n&quot;</span><span class="sc">;</span></li></ol></pre><p>which outputs</p>
<pre class="verbatim"><ol><li>  side = [/ [- [sqrt [+ 1 [** [n 1 u] 2]] u] 1] [n 1 u]]</li></ol></pre><p>and one can inspect the value in debugger using all the possible
methods.</p>
<p>Something is still amiss: consider the loop variable $cnt of the
script.  It was a number, not an object.  We cannot make this value of
type <code class="inline"><span class="w">symbolic</span></code>
, since then the loop will not terminate.</p>
<p>Indeed, to terminate the cycle, the $cnt should become false.
However, the operator <code class="inline"><span class="w">bool</span></code>
 for checking falsity is overloaded (this
time via overloaded <code class="inline"><span class="q">&quot;&quot;</span></code>
), and returns a long string, thus any object
of type <code class="inline"><span class="w">symbolic</span></code>
 is true.  To overcome this, we need a way to
compare an object to 0.  In fact, it is easier to write a numeric
conversion routine.</p>
<p>Here is the text of <i>symbolic.pm</i> with such a routine added (and
slightly modified str()):</p>
<pre class="verbatim"><ol><li><a name="package-symbolic"></a>  package <span class="i">symbolic</span><span class="sc">;</span>		<span class="c"># Primitive symbolic calculator</span></li><li>  <a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></li><li>    <span class="w">nomethod</span> <span class="cm">=&gt;</span> \<span class="i">&amp;wrap</span><span class="cm">,</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;str</span><span class="cm">,</span> <span class="q">&#39;0+&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;num</span><span class="sc">;</span></li><li></li><li><a name="new"></a>  sub <span class="m">new</span> <span class="s">{</span> <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span> <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="q">&#39;n&#39;</span><span class="cm">,</span> <span class="i">@_</span><span class="s">]</span> <span class="s">}</span></li><li><a name="wrap"></a>  sub <span class="m">wrap</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$obj</span><span class="cm">,</span> <span class="i">$other</span><span class="cm">,</span> <span class="i">$inv</span><span class="cm">,</span> <span class="i">$meth</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span></li><li>    <span class="s">(</span><span class="i">$obj</span><span class="cm">,</span> <span class="i">$other</span><span class="s">)</span> = <span class="s">(</span><span class="i">$other</span><span class="cm">,</span> <span class="i">$obj</span><span class="s">)</span> if <span class="i">$inv</span><span class="sc">;</span></li><li>    <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="i">$meth</span><span class="cm">,</span> <span class="i">$obj</span><span class="cm">,</span> <span class="i">$other</span><span class="s">]</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li><a name="str"></a>  sub <span class="m">str</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$meth</span><span class="cm">,</span> <span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span><span class="s">)</span> = <span class="i">@</span>{+<a class="l_k" href="functions/shift.html">shift</a>}<span class="sc">;</span></li><li>    <span class="i">$a</span> = <span class="q">&#39;u&#39;</span> unless <a class="l_k" href="functions/defined.html">defined</a> <span class="i">$a</span><span class="sc">;</span></li><li>    if <span class="s">(</span><a class="l_k" href="functions/defined.html">defined</a> <span class="i">$b</span><span class="s">)</span> <span class="s">{</span></li><li>      <span class="q">&quot;[$meth $a $b]&quot;</span><span class="sc">;</span></li><li>    <span class="s">}</span> else <span class="s">{</span></li><li>      <span class="q">&quot;[$meth $a]&quot;</span><span class="sc">;</span></li><li>    <span class="s">}</span></li><li>  <span class="s">}</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">%subr</span> = <span class="s">(</span> <span class="w">n</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><span class="i">$_</span>[<span class="n">0</span>]<span class="s">}</span><span class="cm">,</span></li><li>	       <span class="w">sqrt</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><a class="l_k" href="functions/sqrt.html">sqrt</a> <span class="i">$_</span>[<span class="n">0</span>]<span class="s">}</span><span class="cm">,</span></li><li>	       <span class="q">&#39;-&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span> - <a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span><span class="s">}</span><span class="cm">,</span></li><li>	       <span class="q">&#39;+&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span> + <a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span><span class="s">}</span><span class="cm">,</span></li><li>	       <span class="q">&#39;/&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span> / <a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span><span class="s">}</span><span class="cm">,</span></li><li>	       <span class="q">&#39;*&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span> * <a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span><span class="s">}</span><span class="cm">,</span></li><li>	       <span class="q">&#39;**&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span> ** <a class="l_k" href="functions/shift.html">shift</a><span class="s">(</span><span class="s">)</span><span class="s">}</span><span class="cm">,</span></li><li>	     <span class="s">)</span><span class="sc">;</span></li><li><a name="num"></a>  sub <span class="m">num</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$meth</span><span class="cm">,</span> <span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span><span class="s">)</span> = <span class="i">@</span>{+<a class="l_k" href="functions/shift.html">shift</a>}<span class="sc">;</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$subr</span> = <span class="i">$subr</span>{<span class="i">$meth</span>}</li><li>      or <a class="l_k" href="functions/die.html">die</a> <span class="q">&quot;Do not know how to ($meth) in symbolic&quot;</span><span class="sc">;</span></li><li>    <span class="i">$a</span> = <span class="i">$a</span><span class="i">-&gt;num</span> if <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$a</span> eq <span class="w">__PACKAGE__</span><span class="sc">;</span></li><li>    <span class="i">$b</span> = <span class="i">$b</span><span class="i">-&gt;num</span> if <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$b</span> eq <span class="w">__PACKAGE__</span><span class="sc">;</span></li><li>    <span class="i">$subr</span>-&gt;<span class="s">(</span><span class="i">$a</span><span class="cm">,</span><span class="i">$b</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>All the work of numeric conversion is done in %subr and num().  Of
course, %subr is not complete, it contains only operators used in the
example below.  Here is the extra-credit question: why do we need an
explicit recursion in num()?  (Answer is at the end of this section.)</p>
<p>Use this module like this:</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/require.html">require</a> <span class="w">symbolic</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$iter</span> = <span class="w">symbolic</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">2</span><span class="s">)</span><span class="sc">;</span>	<span class="c"># 16-gon</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$side</span> = <span class="w">symbolic</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$cnt</span> = <span class="i">$iter</span><span class="sc">;</span></li><li></li><li>  while <span class="s">(</span><span class="i">$cnt</span><span class="s">)</span> <span class="s">{</span></li><li>    <span class="i">$cnt</span> = <span class="i">$cnt</span> - <span class="n">1</span><span class="sc">;</span>		<span class="c"># Mutator `--&#39; not implemented</span></li><li>    <span class="i">$side</span> = <span class="s">(</span><a class="l_k" href="functions/sqrt.html">sqrt</a><span class="s">(</span><span class="n">1</span> + <span class="i">$side</span>**<span class="n">2</span><span class="s">)</span> - <span class="n">1</span><span class="s">)</span>/<span class="i">$side</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  <a class="l_k" href="functions/printf.html">printf</a> <span class="q">&quot;%s=%f\n&quot;</span><span class="cm">,</span> <span class="i">$side</span><span class="cm">,</span> <span class="i">$side</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/printf.html">printf</a> <span class="q">&quot;pi=%f\n&quot;</span><span class="cm">,</span> <span class="i">$side</span>*<span class="s">(</span><span class="n">2</span>**<span class="s">(</span><span class="i">$iter</span>+<span class="n">2</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>It prints (without so many line breaks)</p>
<pre class="verbatim"><ol><li>  [/ [- [sqrt [+ 1 [** [/ [- [sqrt [+ 1 [** [n 1] 2]]] 1]</li><li>			  [n 1]] 2]]] 1]</li><li>     [/ [- [sqrt [+ 1 [** [n 1] 2]]] 1] [n 1]]]=0.198912</li><li>  pi=3.182598</li></ol></pre><p>The above module is very primitive.  It does not implement
mutator methods (<code class="inline">++</code>
, <code class="inline">-=</code>
 and so on), does not do deep copying
(not required without mutators!), and implements only those arithmetic
operations which are used in the example.</p>
<p>To implement most arithmetic operations is easy; one should just use
the tables of operations, and change the code which fills %subr to</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">%subr</span> = <span class="s">(</span> <span class="q">&#39;n&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><span class="i">$_</span>[<span class="n">0</span>]<span class="s">}</span> <span class="s">)</span><span class="sc">;</span></li><li>  foreach <a class="l_k" href="functions/my.html">my</a> <span class="i">$op</span> <span class="s">(</span><a class="l_k" href="functions/split.html">split</a> <span class="q">&quot; &quot;</span><span class="cm">,</span> <span class="i">$overload::ops</span>{<span class="w">with_assign</span>}<span class="s">)</span> <span class="s">{</span></li><li>    <span class="i">$subr</span>{<span class="i">$op</span>} = <span class="i">$subr</span>{<span class="q">&quot;$op=&quot;</span>} = <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&quot;sub {shift() $op shift()}&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">@bins</span> = <span class="q">qw(binary 3way_comparison num_comparison str_comparison)</span><span class="sc">;</span></li><li>  foreach <a class="l_k" href="functions/my.html">my</a> <span class="i">$op</span> <span class="s">(</span><a class="l_k" href="functions/split.html">split</a> <span class="q">&quot; &quot;</span><span class="cm">,</span> <span class="q">&quot;@overload::ops{ @bins }&quot;</span><span class="s">)</span> <span class="s">{</span></li><li>    <span class="i">$subr</span>{<span class="i">$op</span>} = <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&quot;sub {shift() $op shift()}&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  foreach <a class="l_k" href="functions/my.html">my</a> <span class="i">$op</span> <span class="s">(</span><a class="l_k" href="functions/split.html">split</a> <span class="q">&quot; &quot;</span><span class="cm">,</span> <span class="q">&quot;@overload::ops{qw(unary func)}&quot;</span><span class="s">)</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/print.html">print</a> <span class="q">&quot;defining `$op&#39;\n&quot;</span><span class="sc">;</span></li><li>    <span class="i">$subr</span>{<span class="i">$op</span>} = <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&quot;sub {$op shift()}&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>Due to <a href="#Calling-Conventions-for-Mutators">Calling Conventions for Mutators</a>, we do not need anything
special to make <code class="inline">+=</code>
 and friends work, except filling <code class="inline">+=</code>
 entry of
%subr, and defining a copy constructor (needed since Perl has no
way to know that the implementation of <code class="inline"><span class="q">&#39;+=&#39;</span></code>
 does not mutate
the argument, compare <a href="#Copy-Constructor">Copy Constructor</a>).</p>
<p>To implement a copy constructor, add <code class="inline"><span class="q">&#39;=&#39;</span> <span class="cm">=&gt;</span> \<span class="i">&amp;cpy</span></code>
 to <code class="inline"><a class="l_k" href="functions/use.html">use</a> <span class="w">overload</span></code>

line, and code (this code assumes that mutators change things one level
deep only, so recursive copying is not needed):</p>
<pre class="verbatim"><ol><li><a name="cpy"></a>  sub <span class="m">cpy</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$self</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>    <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="i">@$self</span><span class="s">]</span><span class="cm">,</span> <a class="l_k" href="functions/ref.html">ref</a> <span class="i">$self</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>To make <code class="inline">++</code>
 and <code class="inline">--</code>
 work, we need to implement actual mutators,
either directly, or in <code class="inline"><span class="w">nomethod</span></code>
.  We continue to do things inside
<code class="inline"><span class="w">nomethod</span></code>
, thus add</p>
<pre class="verbatim"><ol><li>    if <span class="s">(</span><span class="i">$meth</span> eq <span class="q">&#39;++&#39;</span> or <span class="i">$meth</span> eq <span class="q">&#39;--&#39;</span><span class="s">)</span> <span class="s">{</span></li><li>      <span class="i">@$obj</span> = <span class="s">(</span><span class="i">$meth</span><span class="cm">,</span> <span class="s">(</span><a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="i">@$obj</span><span class="s">]</span><span class="s">)</span><span class="cm">,</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span> <span class="c"># Avoid circular reference</span></li><li>      <a class="l_k" href="functions/return.html">return</a> <span class="i">$obj</span><span class="sc">;</span></li><li>    <span class="s">}</span></li></ol></pre><p>after the first line of wrap().  This is not a most effective
implementation, one may consider</p>
<pre class="verbatim"><ol><li><a name="inc"></a>  sub <span class="m">inc</span> <span class="s">{</span> <span class="i">$_</span>[<span class="n">0</span>] = <a class="l_k" href="functions/bless.html">bless</a> <span class="s">[</span><span class="q">&#39;++&#39;</span><span class="cm">,</span> <a class="l_k" href="functions/shift.html">shift</a><span class="cm">,</span> <span class="n">1</span><span class="s">]</span><span class="sc">;</span> <span class="s">}</span></li></ol></pre><p>instead.</p>
<p>As a final remark, note that one can fill %subr by</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">%subr</span> = <span class="s">(</span> <span class="q">&#39;n&#39;</span> <span class="cm">=&gt;</span> <a class="l_k" href="functions/sub.html">sub</a> <span class="s">{</span><span class="i">$_</span>[<span class="n">0</span>]<span class="s">}</span> <span class="s">)</span><span class="sc">;</span></li><li>  foreach <a class="l_k" href="functions/my.html">my</a> <span class="i">$op</span> <span class="s">(</span><a class="l_k" href="functions/split.html">split</a> <span class="q">&quot; &quot;</span><span class="cm">,</span> <span class="i">$overload::ops</span>{<span class="w">with_assign</span>}<span class="s">)</span> <span class="s">{</span></li><li>    <span class="i">$subr</span>{<span class="i">$op</span>} = <span class="i">$subr</span>{<span class="q">&quot;$op=&quot;</span>} = <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&quot;sub {shift() $op shift()}&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">@bins</span> = <span class="q">qw(binary 3way_comparison num_comparison str_comparison)</span><span class="sc">;</span></li><li>  foreach <a class="l_k" href="functions/my.html">my</a> <span class="i">$op</span> <span class="s">(</span><a class="l_k" href="functions/split.html">split</a> <span class="q">&quot; &quot;</span><span class="cm">,</span> <span class="q">&quot;@overload::ops{ @bins }&quot;</span><span class="s">)</span> <span class="s">{</span></li><li>    <span class="i">$subr</span>{<span class="i">$op</span>} = <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&quot;sub {shift() $op shift()}&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  foreach <a class="l_k" href="functions/my.html">my</a> <span class="i">$op</span> <span class="s">(</span><a class="l_k" href="functions/split.html">split</a> <span class="q">&quot; &quot;</span><span class="cm">,</span> <span class="q">&quot;@overload::ops{qw(unary func)}&quot;</span><span class="s">)</span> <span class="s">{</span></li><li>    <span class="i">$subr</span>{<span class="i">$op</span>} = <a class="l_k" href="functions/eval.html">eval</a> <span class="q">&quot;sub {$op shift()}&quot;</span><span class="sc">;</span></li><li>  <span class="s">}</span></li><li>  <span class="i">$subr</span>{<span class="q">&#39;++&#39;</span>} = <span class="i">$subr</span>{<span class="q">&#39;+&#39;</span>}<span class="sc">;</span></li><li>  <span class="i">$subr</span>{<span class="q">&#39;--&#39;</span>} = <span class="i">$subr</span>{<span class="q">&#39;-&#39;</span>}<span class="sc">;</span></li></ol></pre><p>This finishes implementation of a primitive symbolic calculator in
50 lines of Perl code.  Since the numeric values of subexpressions
are not cached, the calculator is very slow.</p>
<p>Here is the answer for the exercise: In the case of str(), we need no
explicit recursion since the overloaded <code class="inline">.</code>-operator will fall back
to an existing overloaded operator <code class="inline"><span class="q">&quot;&quot;</span></code>
.  Overloaded arithmetic
operators <i>do not</i> fall back to numeric conversion if <code class="inline"><span class="w">fallback</span></code>
 is
not explicitly requested.  Thus without an explicit recursion num()
would convert <code class="inline"><span class="s">[</span><span class="q">&#39;+&#39;</span><span class="cm">,</span> <span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span><span class="s">]</span></code>
 to <code class="inline"><span class="i">$a</span> + <span class="i">$b</span></code>
, which would just rebuild
the argument of num().</p>
<p>If you wonder why defaults for conversion are different for str() and
num(), note how easy it was to write the symbolic calculator.  This
simplicity is due to an appropriate choice of defaults.  One extra
note: due to the explicit recursion num() is more fragile than sym():
we need to explicitly check for the type of $a and $b.  If components
$a and $b happen to be of some related type, this may lead to problems.</p>
<a name="_Really_-symbolic-calculator"></a><h2><i>Really</i> symbolic calculator</h2>
<p>One may wonder why we call the above calculator symbolic.  The reason
is that the actual calculation of the value of expression is postponed
until the value is <i>used</i>.</p>
<p>To see it in action, add a method</p>
<pre class="verbatim"><ol><li><a name="STORE"></a>  sub <span class="m">STORE</span> <span class="s">{</span></li><li>    <a class="l_k" href="functions/my.html">my</a> <span class="i">$obj</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span></li><li>    <span class="i">$#$obj</span> = <span class="n">1</span><span class="sc">;</span></li><li>    <span class="i">@$obj</span>-&gt;[<span class="n">0</span><span class="cm">,</span><span class="n">1</span>] = <span class="s">(</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <a class="l_k" href="functions/shift.html">shift</a><span class="s">)</span><span class="sc">;</span></li><li>  <span class="s">}</span></li></ol></pre><p>to the package <code class="inline"><span class="w">symbolic</span></code>
.  After this change one can do</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$a</span> = <span class="w">symbolic</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">3</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$b</span> = <span class="w">symbolic</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">4</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$c</span> = <a class="l_k" href="functions/sqrt.html">sqrt</a><span class="s">(</span><span class="i">$a</span>**<span class="n">2</span> + <span class="i">$b</span>**<span class="n">2</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>and the numeric value of $c becomes 5.  However, after calling</p>
<pre class="verbatim"><ol><li>  <span class="i">$a</span><span class="i">-&gt;STORE</span><span class="s">(</span><span class="n">12</span><span class="s">)</span><span class="sc">;</span>  <span class="i">$b</span><span class="i">-&gt;STORE</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>the numeric value of $c becomes 13.  There is no doubt now that the module
symbolic provides a <i>symbolic</i> calculator indeed.</p>
<p>To hide the rough edges under the hood, provide a tie()d interface to the
package <code class="inline"><span class="w">symbolic</span></code>
 (compare with <a href="#Metaphor-clash">Metaphor clash</a>).  Add methods</p>
<pre class="verbatim"><ol><li><a name="TIESCALAR"></a>  sub <span class="m">TIESCALAR</span> <span class="s">{</span> <a class="l_k" href="functions/my.html">my</a> <span class="i">$pack</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span> <span class="i">$pack</span><span class="i">-&gt;new</span><span class="s">(</span><span class="i">@_</span><span class="s">)</span> <span class="s">}</span></li><li><a name="FETCH"></a>  sub <span class="m">FETCH</span> <span class="s">{</span> <a class="l_k" href="functions/shift.html">shift</a> <span class="s">}</span></li><li><a name="nop"></a>  sub <span class="m">nop</span> <span class="s">{</span>  <span class="s">}</span>		<span class="c"># Around a bug</span></li></ol></pre><p>(the bug is described in <a href="#BUGS">BUGS</a>).  One can use this new interface as</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/tie.html">tie</a> <span class="i">$a</span><span class="cm">,</span> <span class="q">&#39;symbolic&#39;</span><span class="cm">,</span> <span class="n">3</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/tie.html">tie</a> <span class="i">$b</span><span class="cm">,</span> <span class="q">&#39;symbolic&#39;</span><span class="cm">,</span> <span class="n">4</span><span class="sc">;</span></li><li>  <span class="i">$a</span><span class="i">-&gt;nop</span><span class="sc">;</span>  <span class="i">$b</span><span class="i">-&gt;nop</span><span class="sc">;</span>	<span class="c"># Around a bug</span></li><li></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$c</span> = <a class="l_k" href="functions/sqrt.html">sqrt</a><span class="s">(</span><span class="i">$a</span>**<span class="n">2</span> + <span class="i">$b</span>**<span class="n">2</span><span class="s">)</span><span class="sc">;</span></li></ol></pre><p>Now numeric value of $c is 5.  After <code class="inline"><span class="i">$a</span> = <span class="n">12</span><span class="sc">;</span> <span class="i">$b</span> = <span class="n">5</span></code>
 the numeric value
of $c becomes 13.  To insulate the user of the module add a method</p>
<pre class="verbatim"><ol><li><a name="vars"></a>  sub <span class="m">vars</span> <span class="s">{</span> <a class="l_k" href="functions/my.html">my</a> <span class="i">$p</span> = <a class="l_k" href="functions/shift.html">shift</a><span class="sc">;</span> <a class="l_k" href="functions/tie.html">tie</a><span class="s">(</span><span class="i">$_</span><span class="cm">,</span> <span class="i">$p</span><span class="s">)</span><span class="cm">,</span> <span class="i">$_</span><span class="i">-&gt;nop</span> foreach <span class="i">@_</span><span class="sc">;</span> <span class="s">}</span></li></ol></pre><p>Now</p>
<pre class="verbatim"><ol><li>  <a class="l_k" href="functions/my.html">my</a> <span class="s">(</span><span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span><span class="s">)</span><span class="sc">;</span></li><li>  <span class="w">symbolic</span><span class="w">-&gt;vars</span><span class="s">(</span><span class="i">$a</span><span class="cm">,</span> <span class="i">$b</span><span class="s">)</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/my.html">my</a> <span class="i">$c</span> = <a class="l_k" href="functions/sqrt.html">sqrt</a><span class="s">(</span><span class="i">$a</span>**<span class="n">2</span> + <span class="i">$b</span>**<span class="n">2</span><span class="s">)</span><span class="sc">;</span></li><li></li><li>  <span class="i">$a</span> = <span class="n">3</span><span class="sc">;</span> <span class="i">$b</span> = <span class="n">4</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/printf.html">printf</a> <span class="q">&quot;c5  %s=%f\n&quot;</span><span class="cm">,</span> <span class="i">$c</span><span class="cm">,</span> <span class="i">$c</span><span class="sc">;</span></li><li></li><li>  <span class="i">$a</span> = <span class="n">12</span><span class="sc">;</span> <span class="i">$b</span> = <span class="n">5</span><span class="sc">;</span></li><li>  <a class="l_k" href="functions/printf.html">printf</a> <span class="q">&quot;c13  %s=%f\n&quot;</span><span class="cm">,</span> <span class="i">$c</span><span class="cm">,</span> <span class="i">$c</span><span class="sc">;</span></li></ol></pre><p>shows that the numeric value of $c follows changes to the values of $a
and $b.</p>
<a name="AUTHOR"></a><h1>AUTHOR</h1>
<p>Ilya Zakharevich &lt;<i>ilya@math.mps.ohio-state.edu</i>&gt;.</p>
<a name="SEE-ALSO"></a><h1>SEE ALSO</h1>
<p>The <a href="overloading.html">overloading</a> pragma can be used to enable or disable overloaded
operations within a lexical scope.</p>
<a name="DIAGNOSTICS"></a><h1>DIAGNOSTICS</h1>
<p>When Perl is run with the <b>-Do</b> switch or its equivalent, overloading
induces diagnostic messages.</p>
<p>Using the <code class="inline"><a class="l_k" href="functions/m.html">m</a></code> command of Perl debugger (see <a href="perldebug.html">perldebug</a>) one can
deduce which operations are overloaded (and which ancestor triggers
this overloading). Say, if <code class="inline">eq</code>
 is overloaded, then the method <code class="inline">(eq</code>
is shown by debugger. The method <code class="inline"><span class="s">(</span><span class="s">)</span></code>
 corresponds to the <code class="inline"><span class="w">fallback</span></code>

key (in fact a presence of this method shows that this package has
overloading enabled, and it is what is used by the <code class="inline"><span class="w">Overloaded</span></code>

function of module <code class="inline"><span class="w">overload</span></code>
).</p>
<p>The module might issue the following warnings:</p>
<ul>
<li><a name="Odd-number-of-arguments-for-overload%3a%3aconstant"></a><b>Odd number of arguments for overload::constant</b>
<p>(W) The call to overload::constant contained an odd number of arguments.
The arguments should come in pairs.</p>
</li>
<li><a name="%60%25s'-is-not-an-overloadable-type"></a><b>`%s' is not an overloadable type</b>
<p>(W) You tried to overload a constant type the overload package is unaware of.</p>
</li>
<li><a name="%60%25s'-is-not-a-code-reference"></a><b>`%s' is not a code reference</b>
<p>(W) The second (fourth, sixth, ...) argument of overload::constant needs
to be a code reference. Either an anonymous subroutine, or a reference
to a subroutine.</p>
</li>
</ul>
<a name="BUGS"></a><h1>BUGS</h1>
<p>Because it is used for overloading, the per-package hash %OVERLOAD now
has a special meaning in Perl. The symbol table is filled with names
looking like line-noise.</p>
<p>For the purpose of inheritance every overloaded package behaves as if
<code class="inline"><span class="w">fallback</span></code>
 is present (possibly undefined). This may create
interesting effects if some package is not overloaded, but inherits
from two overloaded packages.</p>
<p>Relation between overloading and tie()ing is broken.  Overloading is
triggered or not basing on the <i>previous</i> class of tie()d value.</p>
<p>This happens because the presence of overloading is checked too early,
before any tie()d access is attempted.  If the FETCH()ed class of the
tie()d value does not change, a simple workaround is to access the value
immediately after tie()ing, so that after this call the <i>previous</i> class
coincides with the current one.</p>
<p><b>Needed:</b> a way to fix this without a speed penalty.</p>
<p>Barewords are not covered by overloaded string constants.</p>
<p>This document is confusing.  There are grammos and misleading language
used in places.  It would seem a total rewrite is needed.</p>




  <div id="page_index" class="hud_container">
    <div id="page_index_header" class="hud_header">
      <div id="page_index_close" class="hud_close"><a href="#" onClick="pageIndex.hide();return false;"></a></div>
      <div id="page_index_title" class="hud_title"><span class="hud_span_top">Page index</span></div>
      <div id="page_index_topright" class="hud_topright"></div>
    </div>
    <div id="page_index_content" class="hud_content">
      <ul><li><a href="#NAME">NAME</a><li><a href="#SYNOPSIS">SYNOPSIS</a><li><a href="#DESCRIPTION">DESCRIPTION</a><ul><li><a href="#Declaration-of-overloaded-functions">Declaration of overloaded functions</a><li><a href="#Calling-Conventions-for-Binary-Operations">Calling Conventions for Binary Operations</a><li><a href="#Calling-Conventions-for-Unary-Operations">Calling Conventions for Unary Operations</a><li><a href="#Calling-Conventions-for-Mutators">Calling Conventions for Mutators</a><li><a href="#Overloadable-Operations">Overloadable Operations</a><li><a href="#Inheritance-and-overloading">Inheritance and overloading</a></ul><li><a href="#SPECIAL-SYMBOLS-FOR-use-overload">SPECIAL SYMBOLS FOR use overload</a><ul><li><a href="#Last-Resort">Last Resort</a><li><a href="#Fallback">Fallback</a><li><a href="#Copy-Constructor">Copy Constructor</a></ul><li><a href="#MAGIC-AUTOGENERATION">MAGIC AUTOGENERATION</a><li><a href="#Minimal-set-of-overloaded-operations">Minimal set of overloaded operations</a><li><a href="#Losing-overloading">Losing overloading</a><li><a href="#Run-time-Overloading">Run-time Overloading</a><li><a href="#Public-functions">Public functions</a><li><a href="#Overloading-constants">Overloading constants</a><li><a href="#IMPLEMENTATION">IMPLEMENTATION</a><li><a href="#Metaphor-clash">Metaphor clash</a><li><a href="#Cookbook">Cookbook</a><ul><li><a href="#Two-face-scalars">Two-face scalars</a><li><a href="#Two-face-references">Two-face references</a><li><a href="#Symbolic-calculator">Symbolic calculator</a><li><a href="#_Really_-symbolic-calculator">_Really_ symbolic calculator</a></ul><li><a href="#AUTHOR">AUTHOR</a><li><a href="#SEE-ALSO">SEE ALSO</a><li><a href="#DIAGNOSTICS">DIAGNOSTICS</a><li><a href="#BUGS">BUGS</a></ul>
    </div>
    <div id="page_index_footer" class="hud_footer">
      <div id="page_index_bottomleft" class="hud_bottomleft"></div>
      <div id="page_index_bottom" class="hud_bottom"><span class="hud_span_bottom"></span></div>
      <div id="page_index_resize" class="hud_resize"></div>
    </div>
  </div>


	    &nbsp;
          </div>
          <div id="content_footer">
          </div>
        </div>
        <div class="clear"></div>
      </div>
      
    <div id="footer">
      <div id="footer_content">
        <div id="footer_strapline">
          perldoc.perl.org - Official documentation for the Perl programming language
        </div>
        <div id="footer_links">
          <div id="address">
            <p class="name">Contact details</p>
            <p class="address">
	      Site maintained by <a href="http://perl.jonallen.info">Jon Allen (JJ)</a><br>
	      See the <a href="http://perl.jonallen.info/projects/perldoc">project page</a> for more details
	    </p>
            <p class="contact">
              Documentation maintained by the <a href="http://lists.cpan.org/showlist.cgi?name=perl5-porters">Perl 5 Porters</a>
            </p>
          </div>
          <ul class="f1">
            <li>Manual
              <ul class="f2">
                <li><a href="index-overview.html">Overview</a>
                <li><a href="index-tutorials.html">Tutorials</a>
                <li><a href="index-faq.html">FAQs</a>
                <li><a href="index-history.html">Changes</a>
              </ul>
            <li>Reference
              <ul class="f2">
                <li><a href="index-language.html">Language</a>
                <li><a href="index-functions.html">Functions</a>
                <li><a href="perlop.html">Operators</a>
                <li><a href="perlvar.html">Variables</a>
              </ul>
            <li>Modules
              <ul class="f2">
                <li><a href="index-modules-A.html">Modules</a>
                <li><a href="index-pragmas.html">Pragmas</a>
                <li><a href="index-utilities.html">Utilities</a>
              </ul>
            <li>Misc
              <ul class="f2">
                <li><a href="index-licence.html">License</a>
                <li><a href="index-internals.html">Internals</a>
                <li><a href="index-platforms.html">Platforms</a>
              </ul>          </ul>
          <div class="clear"></div>
        </div>
      </div>
      <div id="footer_end">
      </div>
    </div>
      
    </div>
      <script language="JavaScript" type="text/javascript" src="static/exploreperl.js"></script>
      <script language="JavaScript" src="static/combined-20100403.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
  perldoc.setPath(0);
  perldoc.pageName    = 'overload';
  perldoc.pageAddress = 'overload.html';
  perldoc.contentPage = 1;
  explorePerl.render();
  explorePerl.addEvents('explore_anchor');
</script>
    
  </body>
</html>
